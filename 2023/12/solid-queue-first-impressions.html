<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Solid Queue first impressions: Nice! | Island94.org</title>

  <meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="cKxLy3FGn95j-fsvp_WVE5oo6-MIAz9kG_vvzH4YrRVHYnYMKtZmA8odngQlS-Wtu8W3gHoCM8RQ7wg_7YUliw" />
  

  <link rel="alternate" type="application/rss+xml" title="Island94.org" href="https://island94.org/feed.xml">

  <link rel="stylesheet" href="/assets/application-3c56ab95cf55e7f461f0ea9391c2b1391a5c64b74433224fe76ad58b7fa20c07.css" data-turbo-track="reload" />
  <script src="/assets/main-57967bd29e3a27ba3099fee5997ee6ec8c59ef209085f949b6eac799b21915b0.js"></script>

  <script>
    let theme = localStorage.getItem('theme');
    if (!["light", "dark"].includes(theme)) {
      theme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    }
    document.documentElement.setAttribute('data-bs-theme', theme);
  </script>

  
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light mb-2 flex-column">
  <div class="container">
    <a class="navbar-brand" href="/">Island94.org</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item"><a class="nav-link" href="/about">About</a></li>
        <li class="nav-item"><a class="nav-link" href="/archives">Archives</a></li>
        <li class="nav-item"><a class="nav-link" href="/tags">Tags</a></li>
        <li class="nav-item"><a class="nav-link" href="/feed.xml">RSS Feed <i class="bi bi-rss-fill"></i></a></li>

        <li class="nav-item py-2 py-lg-1 col-12 col-lg-auto">
          <div class="vr d-none d-lg-flex h-100 mx-lg-2 text-light-500"></div>
          <hr class="d-lg-none my-0 text-light-500">
        </li>

        <li class="nav-item dropdown">
          <button id="bs-theme" class="btn btn-link nav-link dropdown-toggle" type="button" aria-expanded="false" data-bs-toggle="dropdown"  aria-label="Theme (Auto)">
            <i data-bs-theme-active-icon class="bi bi-circle-half"></i>
            <span data-bs-theme-label>Theme</span>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bs-theme-text">
            <li>
              <button type="button" class="dropdown-item" data-bs-theme-value="light" aria-pressed="false">
                <i class="bi bi-sun"></i> Light
              </button>
            </li>
            <li>
              <button type="button" class="dropdown-item" data-bs-theme-value="dark" aria-pressed="false">
                <i class="bi bi-moon-stars-fill"></i> Dark
              </button>
            </li>
            <li>
              <button type="button" class="dropdown-item" data-bs-theme-value="auto" aria-pressed="true">
                <i class="bi bi-circle-half"></i> Auto
              </button>
            </li>
          </ul>
        </li>

      </ul>

      <form id="search" class="d-flex" action="/search" method="get">
        <input id="search-box" class="form-control search" role="search" name="q" placeholder="Search" aria-label="Search" results="0" type="text">
        <button class="visually-hidden" type="submit">Search</button>
      </form>
    </div>
  </div>
  <div class="container">
    <div class="text-muted fst-italic">
      ‚Äî Ben Sheldon's personal blog and <a href="/2012/04/A-Commonplace-Book.html">commonplace book</a>.
    </div>
  </div>
</nav>


  <div class="container container-body">
    
<div class="container container-body">
  <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">
      <a class="post-link" href="/2023/12/solid-queue-first-impressions"><p>Solid Queue first impressions: Nice!</p>
</a>
    </h1>
    <p class="post-meta text-muted">
        <time datetime="2023-12-19T08:24:00-08:00" itemprop="datePublished">December 19, 2023</time>

        ‚Ä¢ Tagged Rails and GoodJob
    </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p><a href="https://github.com/basecamp/solid_queue">Solid Queue</a> was <a href="https://dev.37signals.com/introducing-solid-queue/">released yesterday</a>, a new relational-database backend for Active Job.</p>

<p>I‚Äôm the author of <a href="https://github.com/bensheldon/good_job">GoodJob</a> and I‚Äôve been <a href="https://island94.org/2023/10/reflections-on-good-job-for-solid-queue">following along</a> and am very interested and excited about Solid Queue. These are some things I noticed when first going through it.</p>

<p><strong>tl;dr;</strong> It‚Äôs nice! I learned some things. It makes a few different choices than GoodJob and I‚Äôm very curious how they turn out (in a good way!).</p>

<p>I admit, I didn‚Äôt run Solid Queue in production. I poked through the code, got the development environment set up (spent the majority of my time trying to get <code>mysql2</code> to compile, which is no surprise for me; <a href="https://github.blog/2022-08-25-introducing-trilogy-a-new-database-adapter-for-ruby-on-rails/">Trilogy is my day job</a>), ran the test suite and tried TDDing a new feature for it: <code>perform_all_later</code> support. These are just my notes, something to refer back to.</p>

<p><strong>Lots of database tables:</strong> Solid Queue has many database tables. There is a ‚Äúhot‚Äù table (my terminology) in which job records are queued/dequeued/locked from by all the workers, and then several other tables where job records are staged (e.g. they‚Äôre scheduled in the future, so don‚Äôt insert them into the hot table yet) or archived after they complete/error.  This seems smart because that hot table and its indexes stays compact and single purpose, which is good for performance. Compare that to GoodJob in which the jobs table has like 8 indexes to cover both queue/dequeue and Dashboard listings and everything else, which <em>does</em> slow down inserts and updates. I‚Äôve had the impression with GoodJob that orchestrating across multiple tables would be more difficult (everything is tradeoffs!), so I‚Äôm very curious to see an alternative implementation in Solid Queue.</p>

<p><em>Note: I wasn‚Äôt successfully able to implement <code>perform_all_later</code> in my 1 hour timebox because it was more complicated than an <code>insert_all</code> because of the necessity of writing to multiple tables.</em></p>

<p><em>Aside: One of the very first comments I got when I launched GoodJob 3 years ago was like ‚Äúyour design assumptions are less than ideal‚Äù and then they never replied to any of my follow-ups. That sucked! This is not that. Nothing in Solid Queue is particularly concerning, just different (sometimes better!). Kudos to Rosa Guti√©rrez and the Solid Queue developers; you‚Äôre doing great work! üíñ</em></p>

<p><strong>Again, lots of database tables:</strong> GoodJob is easy mode just targeting Postgres, because there are Advisory Locks and lots of Postgres-only niceties. I do not envy Solid Queue being multi-database, because it has to implement a bunch of stuff with a coarser toolbox. For example, there is a <code>semaphores</code> table, which is used for the Concurrency Controls feature (üéâ). I think the ‚ÄúSOLID‚Äù libraries (also Solid Cache) are interesting because they have to implement behavior in a relational database that come for free in in-memory databases (example: TTL/record expiration/purging).</p>

<p><strong>Puma Plugin:</strong> TIL. Looks nicer and more explicit than GoodJob trying to transparently detect it‚Äôs in the webserver to run asynchronously</p>

<p><strong>Multiprocess.</strong> A nice surprise to me, Solid Queue has a multiprocess supervisor. It does seem like even the Puma plugin forks off another process though; that could have implications for memory constrained environments (e.g. Heroku dynos). I‚Äôm nearly 4 years into GoodJob and haven‚Äôt tackled multiprocess yet, so exciting to see this in Solid Queue‚Äôs first release.</p>

<p><strong>Queue priority:</strong> Nice! I have <em>opinions</em> about how people set up their application‚Äôs queues, along the lines of: many people do it wrong, imo. Solid Queue looks like it provides a lot of good flexibility to let people easily migrate and configure their queues initially (though wrongly, by dependency, imo), but then reorient them more performantly (by latency, again imo). A single thread-pool/worker can pull from multiple queues.</p>

<p><strong>Care</strong>. I notice lots of little things that are nice in Solid Queue. The code is clean. The indexes are named for their purpose/usage rather than just like <code>index_table_column_column</code>.  The Puma Plugin is nice. There are things in GoodJob that I dream about what a clean-room, lessons-learned reimplementation would look like, but it‚Äôs never top of my priorities, and some things are never going back in the stable (table names are basically forever). Reading the Solid Queue code was a vicarious-nice! experience.</p>

<p><strong>Differences.</strong> Do they even matter? I dunno:</p>

<ul>
  <li>No Dashboard yet. Waiting on Mission Control. GoodJob definitely got more twisty as I learned all of the things of ‚Äúyou want a button to do what now with those jobs? ‚Ä¶oh, I guess that makes sense. hmm.‚Äù</li>
  <li>No LISTEN/NOTIFY (yet?). Seems possible, but would be Postgres only so maybe not. That means latency will never be less than the polling frequency, though an example shows <code>0.1</code> seconds which seems good to me.</li>
  <li><del>No cron-like functionality. It took me a minute to <a href="https://github.com/bensheldon/good_job/issues/255">come around to the the necessity of this</a>, maybe Solid Queue will too.</del> ü§¶ I missed this on first read through: ‚ÄúUnique jobs and recurring, cron-like tasks are coming very soon.‚Äù üôå</li>
</ul>

<p><strong>Final thoughts:</strong> Path dependency is hard, so I don‚Äôt imagine lots of people should swap out their job backend just because there is something new (please, don‚Äôt let me ever read a ‚Äú3 job backends in 4 years‚Äù blog post). New projects and applications will be more likely making these choices (and they shouldn‚Äôt be valueless choices, hence my excitement for Solid Queue becoming first party to Rails) and I‚Äôm really excited to see how Solid Queue grows up with them, and alongside other options like GoodJob and Sidekiq and Delayed et al.</p>

  </div>
</article>


  <div class="card my-4">
    <div class="card-body">
      Discuss this with me on <a href="https://twitter.com/bensheldon"><i class="bi bi-twitter"></i> Twitter</a>
      or suggest a
      <a href="https://github.com/bensheldon/island94.org/blob/main/_posts/2023-12-19-solid-queue-first-impressions.md"><i class="bi bi-github"></i>
        change</a>.
    </div>
      <hr>
      <div class="card-body">
        <h5>Related Posts</h5>
        <ul>
            <li><a href="/2024/9/seeing-like-a-rails-and-ruby-platform-team">Seeing like a Rails and Ruby platform team</a></li>
            <li><a href="/2024/9/secret-to-rails-database-connection-pool-size">The secret to perfectly calculate Rails database connection pool size</a></li>
            <li><a href="/2024/7/notes-from-carrierwave-to-active-storage">Notes from Carrierwave to Active Storage</a></li>
            <li><a href="/2024/7/introducing-goodjob-v4">Introducing GoodJob v4</a></li>
            <li><a href="/2023/11/rails-executor-increasingly-everywhere">The Rails Executor: increasingly everywhere</a></li>
        </ul>
    </div>
  </div>
</div>

  </div>

</body>
</html>
