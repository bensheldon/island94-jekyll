<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" href="/assets/stylesheets/main.css">
  <script src="/assets/javascripts/main.js"></script>

  <title>Island94.org</title>
  <meta name="description" content="A Lost and Found
">

  <link rel="canonical" href="https://island94.org/page/3/">

  <link rel="alternate" type="application/rss+xml" title="Island94.org Posts" href="https://island94.org/feed.xml">
  <link rel="alternate" type="application/rss+xml" title="Island94.org Book Reviews" href="https://island94.org/books.xml">

  
    <meta name="robots" content="noindex, follow">
  
</head>


  <body>

    <nav class="navbar navbar-expand-lg navbar-light mb-2 flex-column">
  <div class="container">
    <a class="navbar-brand" href="/">Island94.org</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item"><a class="nav-link " href="/about/">About</a></li>
        <li class="nav-item"><a class="nav-link " href="/archives/">Archives</a></li>
        <li class="nav-item"><a class="nav-link " href="/books/">Books</a></li>
        <li class="nav-item"><a class="nav-link " href="/tags/">Tags</a></li>
        <li class="nav-item"><a class="nav-link" href="/feed.xml">RSS Feed <i class="bi bi-rss-fill"></i></a></li>

        <li class="nav-item py-2 py-lg-1 col-12 col-lg-auto">
          <div class="vr d-none d-lg-flex h-100 mx-lg-2 text-light-500"></div>
          <hr class="d-lg-none my-0 text-light-500">
        </li>

        <li class="nav-item dropdown">
          <button id="bd-theme" class="btn btn-link nav-link dropdown-toggle" type="button" aria-expanded="false" data-bs-toggle="dropdown"  aria-label="Theme (Auto)">
            <i data-bd-theme-active-icon class="bi bi-circle-half"></i>
            <span data-bd-theme-label>Theme</span>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text">
            <li>
              <button type="button" class="dropdown-item" data-bs-theme-value="light" aria-pressed="false">
                <i class="bi bi-sun"></i> Light
              </button>
            </li>
            <li>
              <button type="button" class="dropdown-item" data-bs-theme-value="dark" aria-pressed="false">
                <i class="bi bi-moon-stars-fill"></i> Dark
              </button>
            </li>
            <li>
              <button type="button" class="dropdown-item" data-bs-theme-value="auto" aria-pressed="true">
                <i class="bi bi-circle-half"></i> Auto
              </button>
            </li>
          </ul>
        </li>

      </ul>

      <form id="search" class="d-flex" action="/search" method="get">
        <input id="search-box" class="form-control search" role="search" name="q" placeholder="Search" aria-label="Search" results="0" type="text">
        <button class="visually-hidden" type="submit">Search</button>
      </form>
    </div>
  </div>
  <div class="container">
    <div class="text-muted fst-italic">
      — Ben Sheldon's personal blog and <a href="/2012/04/A-Commonplace-Book.html">commonplace book</a>.
    </div>
  </div>
</nav>


    <div class="container container-body">
      <div class="home">
  
    

<nav aria-label="Page navigation">
  <ul class="pagination justify-content-center">
    
      <li class="page-item"><a href="/page/2/" class="page-link"><span aria-hidden="true">&larr; </span>Newer</a></li>
    

    <li class="page-item disabled"><span class="page-link">Page 3 of 67</span></li>

    
      <li class="page-item"><a href="/page/4/" class="page-link">Older<span aria-hidden="true"> &rarr;</span></a></li>
    
  </ul>
</nav>


<hr>


  

  
    
      

<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">
      <a class="post-link" href="/2023/05/whatever-you-do-don-t-autoload-rails-lib"><p>Whatever you do, don’t autoload Rails <code class="language-plaintext highlighter-rouge">lib/</code></p>
</a>
    </h1>
    <p class="post-meta text-muted">
      <time datetime="2023-05-02T14:09:00+00:00" itemprop="datePublished">May 2, 2023</time>
      
      



    </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p><em><strong>Update:</strong> Rails v7.1 will introduce a new configuration method <a href="https://github.com/rails/rails/pull/48572"><code class="language-plaintext highlighter-rouge">config.autoload_lib</code></a> to make it safer and easier to autoload the <code class="language-plaintext highlighter-rouge">/lib</code> directory and explicitly exclude directories from autoloading. When released, this advice may no longer be relevant, though I imagine it will still be possible for developers to twist themselves into knots and cause outages with autoloading overrides.</em></p>

<p>One of the most common problems I encounter consulting on Rails projects is that developers have previously added <code class="language-plaintext highlighter-rouge">lib/</code> to autoload paths and then twisted themselves into knots creating error-prone, project-specific conventions for subsequently un-autoloading a subset of files also in <code class="language-plaintext highlighter-rouge">lib/</code>.</p>

<p><em>Don’t do it. Don’t add your Rails project’s <code class="language-plaintext highlighter-rouge">lib/</code> to autoload paths.</em></p>

<h3 id="how-does-this-happen">How does this happen?</h3>

<p>A growing Rails application will accumulate a lot of ruby classes and files that don’t cleanly fit into the default <code class="language-plaintext highlighter-rouge">app/</code> directories of <code class="language-plaintext highlighter-rouge">controllers</code>, <code class="language-plaintext highlighter-rouge">helpers</code>, <code class="language-plaintext highlighter-rouge">jobs</code>, or <code class="language-plaintext highlighter-rouge">models</code>. Developers should also be creating new directories in <code class="language-plaintext highlighter-rouge">app/*</code> to organize like-with-like files (your <code class="language-plaintext highlighter-rouge">app/services/</code> or <code class="language-plaintext highlighter-rouge">app/merchants/</code>, etc.). That’s ok!</p>

<p>But frequently there are one-off classes that don’t seem to rise to the level of their own directory in <code class="language-plaintext highlighter-rouge">app/</code>. From looking through the cruft of projects like <a href="https://github.com/mastodon/mastodon/tree/c62604b5f69c3ad7f5449e0a7dc26606adebb777/app/lib">Mastodon</a> or applications <a href="https://github.com/codeforamerica/vita-min/tree/2f5faf06f586d1ea3915af262aab7683240f4727/app/lib">I’ve</a> <a href="https://github.com/bensheldon/open311status/blob/2cd70e391770f64d734f462624222fb8f8bc14a4/app/lib/service_requests_pager.rb">worked</a> <a href="https://github.com/bensheldon/open311status/tree/2cd70e391770f64d734f462624222fb8f8bc14a4/app/lib">on</a>, these files look like:</p>

<ul>
  <li>A lone form builder</li>
  <li>POROs (“Plain old Ruby objects”) like <code class="language-plaintext highlighter-rouge">PhoneNumberFormatter</code>, or <code class="language-plaintext highlighter-rouge">ZipCodes</code> or <code class="language-plaintext highlighter-rouge">Seeder</code>, or <code class="language-plaintext highlighter-rouge">Pagination</code>. Objects that serve a single purpose and are largely singletons/identity objects within the application.</li>
  <li>Boilerplate classes for 3rd party gems, e.g. <code class="language-plaintext highlighter-rouge">ApplicationResponder</code> for the <code class="language-plaintext highlighter-rouge">responders gem</code>.</li>
</ul>

<p>That these files accumulate in a project is a fact of life. When choosing where to put them, that’s when things can go wrong.</p>

<p>In a newly built Rails project <code class="language-plaintext highlighter-rouge">lib/</code> looks like the natural place for these. But <code class="language-plaintext highlighter-rouge">lib/</code> has a downside: <code class="language-plaintext highlighter-rouge">lib/</code> is not autoloaded. This can come as a surprise, even to experienced developers, because they have been accustomed to the convenience of autoloaded files in <code class="language-plaintext highlighter-rouge">app/</code>. It’s not difficult to add an explicit <code class="language-plaintext highlighter-rouge">require</code> statement into <code class="language-plaintext highlighter-rouge">application.rb</code> or in an initializer, but that may not be one’s first thought.</p>

<p>That’s when people jump to googling “how to autoload <code class="language-plaintext highlighter-rouge">lib/</code>”. Don’t do it! <code class="language-plaintext highlighter-rouge">lib/</code> should not be autoloaded.</p>

<p>The problem with autoloading <code class="language-plaintext highlighter-rouge">lib/</code> is that there will subsequently be files added to <code class="language-plaintext highlighter-rouge">lib/</code> that should <em>not</em> be autoloaded; because they should only be provisionally loaded in a certain environment or context, or deferred, for behavioral, performance, or memory reasons. If your project has already enabled autoloading on <code class="language-plaintext highlighter-rouge">lib/</code>, it’s now likely you’ll then add additional configuration to un-autoload the new files. These overrides and counter-overrides accumulate over time and become difficult to understand and unwind, and they cause breakage because someone’s intuition of what will or won’t be loaded in a certain environment or context is wrong.</p>

<p>What should you do instead?</p>

<h3 id="an-omakase-solution">An omakase solution</h3>

<p>DHH <a href="https://github.com/rails/rails/pull/47843#issuecomment-1515367267">writes</a>:</p>

<blockquote>
  <p><code class="language-plaintext highlighter-rouge">lib/</code> is intended to be for non-app specific library code that just happens to live in the app for now (usually pending extraction into open source or whatever). Everything app specific that’s part of the domain model should live in <code class="language-plaintext highlighter-rouge">app/models</code> (that directory is for POROs as much as ARs)… Stuff like a generic PhoneNumberFormatter is exactly what <code class="language-plaintext highlighter-rouge">lib/</code> is intended for. And if it’s app specific, for some reason, then <code class="language-plaintext highlighter-rouge">app/models</code> is fine.</p>
</blockquote>

<p>The omakase solution is to manually require files from <code class="language-plaintext highlighter-rouge">lib/</code> or use <code class="language-plaintext highlighter-rouge">app/models</code> generically to mean “Domain Models” rather than solely Active Record models. That’s great! Do that.</p>

<h3 id="a-best-practice">A best practice</h3>

<p>Xavier Noria, Zeitwerk’s creator <a href="https://github.com/rails/rails/issues/37835#issuecomment-757367812">writes</a>:</p>

<blockquote>
  <p>The best practice to accomplish that nowadays is to move that code to <code class="language-plaintext highlighter-rouge">app/lib</code>. Only the Ruby code you want to reload, tasks or other auxiliary files are OK in <code class="language-plaintext highlighter-rouge">lib</code>.</p>
</blockquote>

<p>Sidekiq’s Problems and Troubleshooting <a href="https://github.com/sidekiq/sidekiq/wiki/Problems-and-Troubleshooting#autoloading">explains</a>:</p>

<blockquote>
  <p>A <code class="language-plaintext highlighter-rouge">lib/</code> directory will only cause pain. Move the code to <code class="language-plaintext highlighter-rouge">app/lib/</code> and make sure the code inside follows the class/filename conventions.</p>
</blockquote>

<p>The best practice is to create an <code class="language-plaintext highlighter-rouge">app/lib/</code> directory to home these files. <a href="https://github.com/mastodon/mastodon/tree/c62604b5f69c3ad7f5449e0a7dc26606adebb777/app/lib">Mastodon</a> does it, as do <a href="https://github.com/search?type=code&amp;auto_enroll=true&amp;q=path%3A%2F%5Eapp%5C%2Flib%5C%2F.*%5C.rb%2F">many others</a>.</p>

<p>This “best practice” is not without contention, as usually anything in Rails that deviates from omakase does, like RSpec instead of MiniTest or FactoryBot instead of Fixtures. But creating <code class="language-plaintext highlighter-rouge">app/lib</code> as a convention for Rails apps works for me and many others.</p>

<h3 id="really-dont-autoload-lib">Really, don’t autoload <code class="language-plaintext highlighter-rouge">lib/</code></h3>

<p>Whatever path you take, don’t take the path of autoloading <code class="language-plaintext highlighter-rouge">lib/</code>.</p>

  </div>
</article>

    

    <hr>
  
    
      

<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">
      <a class="post-link" href="/2023/04/the-constant-rabbit">
        I read "The Constant Rabbit" by Jasper Fforde
      </a>
    </h1>
    <p>
      <time datetime="2023-04-30T03:29:00+00:00" itemprop="datePublished">April 30, 2023</time>
      |
      Review
      |
      ★★★★★
    </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>An “Event” has caused rabbits to become anthropomophic. This exchange is the book in a walnut-shell:</p>

<blockquote>

  <p>So while we ate the excellent walnut cake that the Venerable Bunty’s mother’s sister’s daughter’s husband’s son had baked, Venerable Bunty and Connie told us about life inside the colonies, which despite the lack of freedom and limited space were the only areas within the United Kingdom that ran themselves entirely on rabbit socio-egalitarian principles.</p>

  <p>‘It’s occasionally aggressive and often uncompromising,’ said Finkle, ‘but from what I’ve seen of both systems, a country run on rabbit principles would be a step forward – although to be honest, I’m not sure we’d be neurologically suited to the regime. While most humans are wired to be reasonably decent, a few are wired to be utter shits – and they do tend to tip the balance.’</p>

  <p>‘The decent humans are generally supportive of doing the right thing,’ said the Venerable Bunty, ‘but never take it much farther than that. You’re trashing the ecosystem for no reason other than a deluded sense of anthropocentric manifest destiny, and until you stop talking around the issue and actually feel some genuine guilt, there’ll be no change.’</p>

  <p>‘Shame, for want of a better word, is good,’ said Finkle. ‘Shame is right, shame works. Shame is the gateway emotion to increased self-criticism, which leads to realisation, an apology, outrage and eventually meaningful action. We’re not holding our breaths that any appreciable numbers can be arsed to make the journey along that difficult chain of emotional honesty – many good people get past realisation, only to then get horribly stuck at apology – but we live in hope.’</p>

  <p>‘I understand,’ I said, having felt that I too had yet to make the jump to apology.</p>

  <p>‘It’s further evidence of satire being the engine of the Event,’ said Connie, ‘although if that’s true, we’re not sure for whose benefit.’</p>

  <p>‘Certainly not humans’,’ said Finkle, ‘since satire is meant to highlight faults in a humorous way to achieve betterment, and if anything, the presence of rabbits has actually made humans worse.’</p>

  <p>‘Maybe it’s the default position of humans when they feel threatened,’ I ventured, ‘although if I’m honest, I know a lot of people who claim to have “nothing against rabbits” but tacitly do nothing against the overt leporiphobia that surrounds them.’</p>

  <p>‘Or maybe it’s just satire for comedy’s sake and nothing else,’ added Connie, ‘or even more useless, satire that provokes a few guffaws but only low to middling outrage – but is coupled with more talk and no action. A sort of  . . . empty cleverness.’</p>

  <p>‘Maybe a small puff in the right moral direction is the best that could be hoped for,’ added Finkle thoughtfully. ‘Perhaps that’s what satire does – not change things wholesale but nudge the collective consciousness in a direction that favours justice and equality. Is there any more walnut cake?’</p>

  <p>‘I’m afraid I had the last slice,’ I said, ‘but I did ask if anyone else wanted it.’</p>

</blockquote>

  </div>
</article>

    

    <hr>
  
    
      

<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">
      <a class="post-link" href="/2023/04/the-dawn-of-everything">
        I read "The Dawn of Everything" by David Graeber and David Wengrow
      </a>
    </h1>
    <p>
      <time datetime="2023-04-30T02:56:00+00:00" itemprop="datePublished">April 30, 2023</time>
      |
      Review
      |
      ★★★★
    </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <blockquote>

  <p>If there is a particular story we should be telling, a big question we should be asking of human history (instead of the ‘origins of social inequality’), is it precisely this: how did we find ourselves stuck in just one form of social reality, and how did relations based ultimately on violence and domination come to be normalized within it?</p>

  <p>…</p>

  <p>What happens if we treat the rejection of urban life, or of slavery, [or of certain technologies] in certain times and places as something just as significant as the emergence of those same phenomena in others.</p>

  <p>…</p>

  <p>What is the purpose of all this new knowledge, if not to reshape our conceptions of who we are and what we might yet become? If not, in other words, to rediscover the meaning of our third basic freedom: the freedom to create new and different forms of social reality?</p>

</blockquote>

<p>I imagine I’m already on board with David Graeber’s political project, so while I greatly enjoyed it, I found it too long by about a third.</p>

<p>The overall thrust is that people are much more interesting and creative than we give them credit for, and there’s a lot (too much for me in this book) of historical evidence that this is the case. And that it’s bunk to claim that increasing social complexity and scale requires an authoritarian state or bureacracy. I guess it’s an argument to unstick the “End of History”-framing we’re mired in.</p>

<p>Of various things I learned / was confronted with:</p>

<ul>
  <li>Indulging children is Native American practice. Makes sense cause it’s a common theme in Kim Stanley Robinson books of which the Haudenosaunee make frequent appearance too.</li>
  <li>Roman-style property ownership (of which we inherit), is pretty fucked up when stared directly at, based on a patriarch’s relations with household slaves.</li>
  <li>It seems like a pretty legit critique of Western society to point out that there are a lot of <em>legitimate</em> ways poeple are free to harm other people during their every day life, and that’s got to be pretty warpy.</li>
  <li>Spending more time imagining and debating the society and politics you want to live in… probably makes for a better society and politics. One of those, if it’s hard do it a lot sorts of things. And if that sounds annoying in the context of the present, that’s probably because we’ve severely narrowed the scope of debate and possibility.</li>
</ul>

<p>There’s a lot of history and anthropology to boil down:</p>

<blockquote>

  <p>…the key point to remember is that we are not talking here about ‘freedom’ as an abstract ideal or formal principle (as in ‘Liberty, Equality and Fraternity!’). Over the course of these chapters we have instead talked about basic forms of social liberty which one might actually put into practice:</p>

  <ol>
    <li>the freedom to move away or relocate from one’s surroundings;</li>
    <li>the freedom to ignore or disobey commands issued by others; and</li>
    <li>the freedom to shape entirely new social realities, or shift back and forth between different ones</li>
  </ol>

  <p>….three elementary principles of domination:</p>

  <ol>
    <li>control of violence (or sovereignty),</li>
    <li>control of knowledge, and</li>
    <li>charismatic politics</li>
  </ol>

</blockquote>

<p>…and a lot of historical and anthropoligical critique:</p>

<blockquote>

  <p>Environmental determinists have an unfortunate tendency to treat humans as little more than automata, living out some economist’s fantasy of rational calculation. To be fair, they don’t deny that human beings are quirky and imaginative creatures – they just seem to reason that, in the long run, this fact makes very little difference.</p>

  <p>…</p>

  <p>For much of the twentieth century, anthropologists tended to describe the societies they studied in ahistorical terms, as living in a kind of eternal present. Some of this was an effect of the colonial situation under which much ethnographic research was carried out. The British Empire, for instance, maintained a system of indirect rule in various parts of Africa, India and the Middle East where local institutions like royal courts, earth shrines, associations of clan elders, men’s houses and the like were maintained in place, indeed fixed by legislation. Major political change – forming a political party, say, or leading a prophetic movement – was in turn entirely illegal, and anyone who tried to do such things was likely to be put in prison. This obviously made it easier to describe the people anthropologists studied as having a way of life that was timeless and unchanging.</p>

  <p>….</p>

  <p>Social science has been largely a study of the ways in which human beings are not free: the way that our actions and understandings might be said to be determined by forces outside our control. Any account which appears to show human beings collectively shaping their own destiny, or even expressing freedom for its own sake, will likely be written off as illusory, awaiting ‘real’ scientific explanation; or if none is forthcoming (why do people dance?), as outside the scope of social theory entirely. This is one reason why most ‘big histories’ place such a strong focus on technology. Dividing up the human past according to the primary material from which tools and weapons were made (Stone Age, Bronze Age, Iron Age) or else describing it as a series of revolutionary breakthroughs (Agricultural Revolution, Urban Revolution, Industrial Revolution), they then assume that the technologies themselves largely determine the shape that human societies will take for centuries to come – or at least until the next abrupt and unexpected breakthrough comes along to change everything again.</p>

  <p>…</p>

  <p>Choosing to describe history the other way round, as a series of abrupt technological revolutions, each followed by long periods when we were prisoners of our own creations, has consequences. Ultimately it is a way of representing our species as decidedly less thoughtful, less creative, less free than we actually turn out to have been. It means not describing history as a continual series of new ideas and innovations, technical or otherwise, during which different communities made collective decisions about which technologies they saw fit to apply to everyday purposes, and which to keep confined to the domain of experimentation or ritual play. What is true of technological creativity is, of course, even more true of social creativity. One of the most striking patterns we discovered while researching this book – indeed, one of the patterns that felt most like a genuine breakthrough to us – was how, time and again in human history, that zone of ritual play has also acted as a site of social experimentation – even, in some ways, as an encyclopaedia of social possibilities.</p>

</blockquote>

  </div>
</article>

    

    <hr>
  
    
      

<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">
      <a class="post-link" href="/2023/03/how-goodjob-s-mountable-rails-engine-delivers-javascript-importmaps-and-frontend-assets"><p>How GoodJob’s mountable Rails Engine delivers Javascript importmaps and frontend assets</p>
</a>
    </h1>
    <p class="post-meta text-muted">
      <time datetime="2023-03-20T15:27:00+00:00" itemprop="datePublished">March 20, 2023</time>
      
      


  

  

  • Tagged <a href="/tags/#goodjob">GoodJob</a>


    </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p><a href="https://github.com/bensheldon/good_job">GoodJob</a> is a multithreaded, Postgres-based ActiveJob backend for Ruby on Rails.</p>

<p>GoodJob includes a full-featured (though optional) web dashboard to monitor and administer background jobs. The web dashboard is included in the <code class="language-plaintext highlighter-rouge">good_job</code> gem as a mountable Rails Engine.</p>

<p>As the maintainer of GoodJob, I want to make gem development easier for myself by innovating as little as possible. That’s why GoodJob builds on top of Active Record and Concurrent::Ruby.</p>

<p>But, the frontend can be a beast. When thinking about how to build a full-featured web dashboard <em>packaged within a Rails Engine within a gem</em>, I had three goals:</p>

<ol>
  <li><strong>Be asset pipeline agnostic with zero dependencies.</strong> As of Rails ~7.0, a Rails developer can choose between several different asset pipeline tools (Sprockets, Webpacker/Shakapacker, esbuild/jsbundling, etc.). That’s too many! I want to ensure what I package with GoodJob is compatible with all of them. I also don’t want to affect the parent application at all; everything must be independent and self-contained.</li>
  <li><strong>Allow easy patching/debugging.</strong> I want the GoodJob web dashboard to work when using the Git repo directly in a project’s Gemfile or simply <code class="language-plaintext highlighter-rouge">bundle open good_job</code> to debug a problem.</li>
  <li><strong>Write contemporary frontend code.</strong> I want to use Bootstrap UI, Stimulus, Rails UJS, and write modular JavaScript with imports. Maybe even Turbo!</li>
</ol>

<p>And of course, I want GoodJob to be secure, performant, and a joy to develop and use for myself and the developer community.</p>

<p>Read on for how I achieved it all (mostly!) with GoodJob.</p>

<h2 id="what-i-didnt-do">What I didn’t do</h2>

<p>Here’s all the things I considered, but decided not to do:</p>

<ul>
  <li><strong>Nope: Manually construct/inline a small number of javascript files</strong>: I did not want to manually build a javascript file, copy-pasting various various 3rd-party libraries into a single file, and then writing my code at the bottom. This seemed laborious and prone to error, especially when I would need to update a library; and my IDE doesn’t work well with large files so writing my own code would be difficult.</li>
  <li><strong>Nope: Precompile javascript in the repository or on gem build:</strong> I did not want to force a pre-commit step to build javascript, or to only package built javascript into the gem because that would make patching and debugging difficult. Over my career I’ve struggled contributing to a number of otherwise fantastic gems that use this workflow pattern.</li>
  <li><strong>Nope: Compile javascript in the application:</strong> Rails has too many different asset pipeline patterns right now for me to consider supporting them all. I consider this more a result of a highly fragmented frontend ecosystem than an indictment of Rails. I can’t imagine supporting all of the different options and whatever else shows up in the future at the same time. (I’m in awe of the gems that do; nice work <code class="language-plaintext highlighter-rouge">rails_admin</code>!)</li>
</ul>

<h2 id="what-i-did-do">What I did do</h2>

<p>As I wrote earlier: “innovate as little as possible”:</p>

<p><strong>Serve vanilla JS and CSS out of vanilla Routes/Controller</strong></p>

<p>GoodJob has explicit routes for frontend assets that wire up to a controller that serves those assets statically with <code class="language-plaintext highlighter-rouge">render :file</code>. Let’s break that down…</p>

<p>In my Rails Engine’s router, I define a namescape, <code class="language-plaintext highlighter-rouge">frontend</code>, and two <code class="language-plaintext highlighter-rouge">get</code> routes. The first route, <code class="language-plaintext highlighter-rouge">modules</code> , is for Javascript modules that will go into the importmap. The second route, <code class="language-plaintext highlighter-rouge">static</code> , is for Javascript and CSS that I’ll link/script directly in the HTML head.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># config/routes.rb</span>
<span class="n">scope</span> <span class="ss">:frontend</span><span class="p">,</span> <span class="ss">controller: :frontends</span> <span class="k">do</span>
  <span class="n">get</span> <span class="s2">"modules/:name"</span><span class="p">,</span> <span class="ss">action: :module</span><span class="p">,</span> <span class="ss">as: :frontend_module</span><span class="p">,</span> <span class="ss">constraints: </span><span class="p">{</span> <span class="ss">format: </span><span class="s1">'js'</span> <span class="p">}</span>
  <span class="n">get</span> <span class="s2">"static/:name"</span><span class="p">,</span> <span class="ss">action: :static</span><span class="p">,</span> <span class="ss">as: :frontend_static</span><span class="p">,</span> <span class="ss">constraints: </span><span class="p">{</span> <span class="ss">format: </span><span class="sx">%w[css js]</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre></div></div>

<p>In the matching controller, I create static constants that define hashes of files that are matched and served, which I store in a <code class="language-plaintext highlighter-rouge">app/frontend</code> directory in my Rails Engine. <em>I want paths to be explicit for security reasons because passing any sort of dynamic file path through the URL could be a path traversal vulnerability.</em> All of the frontend assets are stored in  <code class="language-plaintext highlighter-rouge">app/frontend</code> and served out of this controller:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># app/controllers/good_job/frontends_controller.rb</span>

<span class="k">module</span> <span class="nn">GoodJob</span>
  <span class="k">class</span> <span class="nc">FrontendsController</span> <span class="o">&lt;</span> <span class="no">ActionController</span><span class="o">::</span><span class="no">Base</span> <span class="c1"># rubocop:disable Rails/ApplicationController</span>
    <span class="no">STATIC_ASSETS</span> <span class="o">=</span> <span class="p">{</span>
      <span class="ss">css: </span><span class="p">{</span>
        <span class="ss">bootstrap: </span><span class="no">GoodJob</span><span class="o">::</span><span class="no">Engine</span><span class="p">.</span><span class="nf">root</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s2">"app"</span><span class="p">,</span> <span class="s2">"frontend"</span><span class="p">,</span> <span class="s2">"good_job"</span><span class="p">,</span> <span class="s2">"vendor"</span><span class="p">,</span> <span class="s2">"bootstrap"</span><span class="p">,</span> <span class="s2">"bootstrap.min.css"</span><span class="p">),</span>
        <span class="ss">style: </span><span class="no">GoodJob</span><span class="o">::</span><span class="no">Engine</span><span class="p">.</span><span class="nf">root</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s2">"app"</span><span class="p">,</span> <span class="s2">"frontend"</span><span class="p">,</span> <span class="s2">"good_job"</span><span class="p">,</span> <span class="s2">"style.css"</span><span class="p">),</span>
      <span class="p">},</span>
      <span class="ss">js: </span><span class="p">{</span>
        <span class="ss">bootstrap: </span><span class="no">GoodJob</span><span class="o">::</span><span class="no">Engine</span><span class="p">.</span><span class="nf">root</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s2">"app"</span><span class="p">,</span> <span class="s2">"frontend"</span><span class="p">,</span> <span class="s2">"good_job"</span><span class="p">,</span> <span class="s2">"vendor"</span><span class="p">,</span> <span class="s2">"bootstrap"</span><span class="p">,</span> <span class="s2">"bootstrap.bundle.min.js"</span><span class="p">),</span>
        <span class="ss">chartjs: </span><span class="no">GoodJob</span><span class="o">::</span><span class="no">Engine</span><span class="p">.</span><span class="nf">root</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s2">"app"</span><span class="p">,</span> <span class="s2">"frontend"</span><span class="p">,</span> <span class="s2">"good_job"</span><span class="p">,</span> <span class="s2">"vendor"</span><span class="p">,</span> <span class="s2">"chartjs"</span><span class="p">,</span> <span class="s2">"chart.min.js"</span><span class="p">),</span>
        <span class="ss">es_module_shims: </span><span class="no">GoodJob</span><span class="o">::</span><span class="no">Engine</span><span class="p">.</span><span class="nf">root</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s2">"app"</span><span class="p">,</span> <span class="s2">"frontend"</span><span class="p">,</span> <span class="s2">"good_job"</span><span class="p">,</span> <span class="s2">"vendor"</span><span class="p">,</span> <span class="s2">"es_module_shims.js"</span><span class="p">),</span>
        <span class="ss">rails_ujs: </span><span class="no">GoodJob</span><span class="o">::</span><span class="no">Engine</span><span class="p">.</span><span class="nf">root</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s2">"app"</span><span class="p">,</span> <span class="s2">"frontend"</span><span class="p">,</span> <span class="s2">"good_job"</span><span class="p">,</span> <span class="s2">"vendor"</span><span class="p">,</span> <span class="s2">"rails_ujs.js"</span><span class="p">),</span>
      <span class="p">},</span>
    <span class="p">}.</span><span class="nf">freeze</span>

		<span class="c1"># Additional JS modules that don't live in app/frontend/good_job/modules</span>
    <span class="no">MODULE_OVERRIDES</span> <span class="o">=</span> <span class="p">{</span>
      <span class="ss">application: </span><span class="no">GoodJob</span><span class="o">::</span><span class="no">Engine</span><span class="p">.</span><span class="nf">root</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s2">"app"</span><span class="p">,</span> <span class="s2">"frontend"</span><span class="p">,</span> <span class="s2">"good_job"</span><span class="p">,</span> <span class="s2">"application.js"</span><span class="p">),</span>
      <span class="ss">stimulus: </span><span class="no">GoodJob</span><span class="o">::</span><span class="no">Engine</span><span class="p">.</span><span class="nf">root</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s2">"app"</span><span class="p">,</span> <span class="s2">"frontend"</span><span class="p">,</span> <span class="s2">"good_job"</span><span class="p">,</span> <span class="s2">"vendor"</span><span class="p">,</span> <span class="s2">"stimulus.js"</span><span class="p">),</span>
    <span class="p">}.</span><span class="nf">freeze</span>

    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">js_modules</span>
      <span class="vi">@_js_modules</span> <span class="o">||=</span> <span class="no">GoodJob</span><span class="o">::</span><span class="no">Engine</span><span class="p">.</span><span class="nf">root</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s2">"app"</span><span class="p">,</span> <span class="s2">"frontend"</span><span class="p">,</span> <span class="s2">"good_job"</span><span class="p">,</span> <span class="s2">"modules"</span><span class="p">).</span><span class="nf">children</span><span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:file?</span><span class="p">).</span><span class="nf">each_with_object</span><span class="p">({})</span> <span class="k">do</span> <span class="o">|</span><span class="n">file</span><span class="p">,</span> <span class="n">modules</span><span class="o">|</span>
        <span class="n">key</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">basename</span><span class="p">(</span><span class="n">file</span><span class="p">.</span><span class="nf">basename</span><span class="p">.</span><span class="nf">to_s</span><span class="p">,</span> <span class="s2">".js"</span><span class="p">).</span><span class="nf">to_sym</span>
        <span class="n">modules</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">file</span>
      <span class="k">end</span><span class="p">.</span><span class="nf">merge</span><span class="p">(</span><span class="no">MODULE_OVERRIDES</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="c1"># Necessarly to serve Javascript to the browser</span>
		<span class="n">skip_after_action</span> <span class="ss">:verify_same_origin_request</span><span class="p">,</span> <span class="ss">raise: </span><span class="kp">false</span>
    <span class="n">before_action</span> <span class="p">{</span> <span class="n">expires_in</span> <span class="mi">1</span><span class="p">.</span><span class="nf">year</span><span class="p">,</span> <span class="ss">public: </span><span class="kp">true</span> <span class="p">}</span>

    <span class="k">def</span> <span class="nf">static</span>
      <span class="n">render</span> <span class="ss">file: </span><span class="no">STATIC_ASSETS</span><span class="p">.</span><span class="nf">dig</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:format</span><span class="p">].</span><span class="nf">to_sym</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="ss">:name</span><span class="p">].</span><span class="nf">to_sym</span><span class="p">)</span> <span class="o">||</span> <span class="k">raise</span><span class="p">(</span><span class="no">ActionController</span><span class="o">::</span><span class="no">RoutingError</span><span class="p">,</span> <span class="s1">'Not Found'</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">module</span>
      <span class="k">raise</span><span class="p">(</span><span class="no">ActionController</span><span class="o">::</span><span class="no">RoutingError</span><span class="p">,</span> <span class="s1">'Not Found'</span><span class="p">)</span> <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="ss">:format</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">"js"</span>

      <span class="n">render</span> <span class="ss">file: </span><span class="nb">self</span><span class="p">.</span><span class="nf">class</span><span class="p">.</span><span class="nf">js_modules</span><span class="p">[</span><span class="n">params</span><span class="p">[</span><span class="ss">:name</span><span class="p">].</span><span class="nf">to_sym</span><span class="p">]</span> <span class="o">||</span> <span class="k">raise</span><span class="p">(</span><span class="no">ActionController</span><span class="o">::</span><span class="no">RoutingError</span><span class="p">,</span> <span class="s1">'Not Found'</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>One downside of this is that I’m unable to use Sass or Typescript or anything that isn’t vanilla CSS or Javascript. So far I haven’t missed that too much; Bootstrap brings a very comprehensive design system and Rubymine is pretty good at hinting Javscript on its own.</p>

<p>Another downside is that I package several hundred kilobytes of frontend code within my gem. This increases the gem size, which is a real bummer if an application isn’t mounting the dashboard. I’ve considered separating the optional dashboard into a separate gem, but I’m deferring that until anyone notices that it’s problematic (so far so good!).</p>

<p><strong>Manually link assets and construct a JS importmaps in my Engine’s layout <code class="language-plaintext highlighter-rouge">&lt;head&gt;</code></strong></p>

<p>Having created the routes and controller actions, I can simply link the static files in the layout html header:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!-- app/views/layouts/good_job/application.html.erg --&gt;</span>
<span class="nt">&lt;head&gt;</span>
  <span class="c">&lt;!-- ... --&gt;</span>
  <span class="nt">&lt;</span><span class="err">%</span><span class="na">#</span> <span class="na">Note:</span> <span class="na">Do</span> <span class="na">not</span> <span class="na">use</span> <span class="na">asset</span> <span class="na">tag</span> <span class="na">helpers</span> <span class="na">to</span> <span class="na">avoid</span> <span class="na">paths</span> <span class="na">being</span> <span class="na">overriden</span> <span class="na">by</span> <span class="na">config.asset_host</span> <span class="err">%</span><span class="nt">&gt;</span>
  <span class="nt">&lt;</span><span class="err">%=</span> <span class="na">tag.link</span> <span class="na">rel:</span> <span class="err">"</span><span class="na">stylesheet</span><span class="err">",</span> <span class="na">href:</span> <span class="na">frontend_static_path</span><span class="err">(</span><span class="na">:bootstrap</span><span class="err">,</span> <span class="na">format:</span> <span class="na">:css</span><span class="err">,</span> <span class="na">v:</span> <span class="na">GoodJob::VERSION</span><span class="err">,</span> <span class="na">locale:</span> <span class="na">nil</span><span class="err">),</span> <span class="na">nonce:</span> <span class="na">content_security_policy_nonce</span> <span class="err">%</span><span class="nt">&gt;</span>
  <span class="nt">&lt;</span><span class="err">%=</span> <span class="na">tag.link</span> <span class="na">rel:</span> <span class="err">"</span><span class="na">stylesheet</span><span class="err">",</span> <span class="na">href:</span> <span class="na">frontend_static_path</span><span class="err">(</span><span class="na">:style</span><span class="err">,</span> <span class="na">format:</span> <span class="na">:css</span><span class="err">,</span> <span class="na">v:</span> <span class="na">GoodJob::VERSION</span><span class="err">,</span> <span class="na">locale:</span> <span class="na">nil</span><span class="err">),</span> <span class="na">nonce:</span> <span class="na">content_security_policy_nonce</span> <span class="err">%</span><span class="nt">&gt;</span>
	
  <span class="nt">&lt;</span><span class="err">%=</span> <span class="na">tag.script</span> <span class="err">"",</span> <span class="na">src:</span> <span class="na">frontend_static_path</span><span class="err">(</span><span class="na">:bootstrap</span><span class="err">,</span> <span class="na">format:</span> <span class="na">:js</span><span class="err">,</span> <span class="na">v:</span> <span class="na">GoodJob::VERSION</span><span class="err">,</span> <span class="na">locale:</span> <span class="na">nil</span><span class="err">),</span> <span class="na">nonce:</span> <span class="na">content_security_policy_nonce</span> <span class="err">%</span><span class="nt">&gt;</span>
  <span class="nt">&lt;</span><span class="err">%=</span> <span class="na">tag.script</span> <span class="err">"",</span> <span class="na">src:</span> <span class="na">frontend_static_path</span><span class="err">(</span><span class="na">:chartjs</span><span class="err">,</span> <span class="na">format:</span> <span class="na">:js</span><span class="err">,</span> <span class="na">v:</span> <span class="na">GoodJob::VERSION</span><span class="err">,</span> <span class="na">locale:</span> <span class="na">nil</span><span class="err">),</span> <span class="na">nonce:</span> <span class="na">content_security_policy_nonce</span> <span class="err">%</span><span class="nt">&gt;</span>
  <span class="nt">&lt;</span><span class="err">%=</span> <span class="na">tag.script</span> <span class="err">"",</span> <span class="na">src:</span> <span class="na">frontend_static_path</span><span class="err">(</span><span class="na">:rails_ujs</span><span class="err">,</span> <span class="na">format:</span> <span class="na">:js</span><span class="err">,</span> <span class="na">v:</span> <span class="na">GoodJob::VERSION</span><span class="err">,</span> <span class="na">locale:</span> <span class="na">nil</span><span class="err">),</span> <span class="na">nonce:</span> <span class="na">content_security_policy_nonce</span> <span class="err">%</span><span class="nt">&gt;</span>
</code></pre></div></div>

<p>Beneath this, I manually construct the JSON the browser expects for importmaps:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!-- Link es_module_shims --&gt;</span>
<span class="nt">&lt;</span><span class="err">%=</span> <span class="na">tag.script</span> <span class="err">"",</span> <span class="na">src:</span> <span class="na">frontend_static_path</span><span class="err">(</span><span class="na">:es_module_shims</span><span class="err">,</span> <span class="na">format:</span> <span class="na">:js</span><span class="err">,</span> <span class="na">v:</span> <span class="na">GoodJob::VERSION</span><span class="err">,</span> <span class="na">locale:</span> <span class="na">nil</span><span class="err">),</span> <span class="na">async:</span> <span class="na">true</span><span class="err">,</span> <span class="na">nonce:</span> <span class="na">content_security_policy_nonce</span> <span class="err">%</span><span class="nt">&gt;</span>

<span class="c">&lt;!-- Construct the importmaps JSON object --&gt;</span>
<span class="nt">&lt;</span><span class="err">%</span> <span class="na">importmaps = </span><span class="s">GoodJob::FrontendsController.js_modules.keys.index_with</span> <span class="err">{</span> <span class="err">|</span><span class="na">module_name</span><span class="err">|</span> <span class="na">frontend_module_path</span><span class="err">(</span><span class="na">module_name</span><span class="err">,</span> <span class="na">format:</span> <span class="na">:js</span><span class="err">,</span> <span class="na">locale:</span> <span class="na">nil</span><span class="err">,</span> <span class="na">v:</span> <span class="na">GoodJob::VERSION</span><span class="err">)</span> <span class="err">}</span> <span class="err">%</span><span class="nt">&gt;</span>
<span class="nt">&lt;</span><span class="err">%=</span> <span class="na">tag.script</span><span class="err">({</span> <span class="na">imports:</span> <span class="na">importmaps</span> <span class="err">}.</span><span class="na">to_json.html_safe</span><span class="err">,</span> <span class="na">type:</span> <span class="err">"</span><span class="na">importmap</span><span class="err">",</span> <span class="na">nonce:</span> <span class="na">content_security_policy_nonce</span><span class="err">)</span> <span class="err">%</span><span class="nt">&gt;</span>

<span class="c">&lt;!-- Import the entrypoint: application.js --&gt;</span>
<span class="nt">&lt;</span><span class="err">%=</span> <span class="na">tag.script</span> <span class="err">"",</span> <span class="na">type:</span> <span class="err">"</span><span class="na">module</span><span class="err">",</span> <span class="na">nonce:</span> <span class="na">content_security_policy_nonce</span> <span class="na">do</span> <span class="err">%</span><span class="nt">&gt;</span> import "application"; <span class="nt">&lt;</span><span class="err">%</span> <span class="na">end</span> <span class="err">%</span><span class="nt">&gt;</span>
</code></pre></div></div>

<h3 id="thats-it">That’s it!</h3>

<p>I’ll admit, serving frontend assets using <code class="language-plaintext highlighter-rouge">render file:</code> is boring, but I experienced a thrill the first time I wired up the importmaps and <em>it just worked</em>. Writing small Javascript modules and using <code class="language-plaintext highlighter-rouge">import</code> directives is really nice. I recently added Stimulus and I’m feeling optimistic that I could reliably implement Turbo in my gem’s Rails Engine fully decoupled from the parent application.</p>

<p>I hope this post about GoodJob inspires you to build full-featured web frontends for your own gems and libraries.</p>

  </div>
</article>

    

    <hr>
  
    
      

<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">
      <a class="post-link" href="/2023/03/recently-march-12-2023"><p>Recently, March 12, 2023</p>
</a>
    </h1>
    <p class="post-meta text-muted">
      <time datetime="2023-03-13T00:26:00+00:00" itemprop="datePublished">March 13, 2023</time>
      
      


  

  

  • Tagged <a href="/tags/#weeknotes">weeknotes</a>


    </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <ul>
  <li>Work has been complicated, recently. <a href="https://techcrunch.com/2023/02/09/github-lays-off-10-and-goes-fully-remote/">Layoffs, as a general idea</a>, were announced a month ago; it was the same week I came down with a bad cold. I’ve been fairly low energy since and have had trouble differentiating the two. I’m supremely proud and confident that my team is doing the most important work possible. We’ll see!</li>
  <li>The week prior to all of this, my dad came to visit and stay with us. Having an easier time hosting family was one of our goals in getting a 2nd bedroom. Success.</li>
  <li>Wow, it’s nearly been a year since I left my last job. I’ve had a number of former colleagues asking for help in leaving, in addition to talking with folks being pushed out: I was surprised to see Code for America finally kill Brigades, and really <a href="https://statescoop.com/code-for-america-local-brigades-ending/">twist the knife too</a> by forcing groups to rename themselves.</li>
  <li>GoodJob is great! I’ve been thinking about <a href="https://github.com/bensheldon/good_job/discussions/831">replacing Advisory Locks</a> with a lock strategy that’s more compatible with PgBouncer. But that will probably be a 2-year project at least of incrementally crabwalking towards that goal while avoiding breaking changes. <a href="https://github.com/rubygems/rubygems.org/pull/3533">Rubygems.org just adopted GoodJob</a>; I am humbled.</li>
  <li>On other projects, I’ve been trying to lower costs. My S3 data-transfer bill went from $10 to $50 a month, which I’m not happy about; scrapers are the worst 🤷‍♀️ I’ve also been experimenting with Dokku for packing some smaller projects (paying $15 once rather than $12 per app), though the VM locked up once on a Saturday night and I had to reboot it and this is exactly why I don’t want to manage my own servers.</li>
  <li>My brother and I have been planning a Celebration of Life for my mom.</li>
  <li>I’m so happy to finally be back on Daylight Savings Time.</li>
</ul>

  </div>
</article>

    

    <hr>
  
    
      

<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">
      <a class="post-link" href="/2023/02/service-object-objects-in-ruby"><p>Service Object Objects in Ruby</p>
</a>
    </h1>
    <p class="post-meta text-muted">
      <time datetime="2023-02-14T16:18:00+00:00" itemprop="datePublished">February 14, 2023</time>
      
      


  

  

  • Tagged <a href="/tags/#ruby">Ruby</a>


    </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>For anyone that follows me on social media, I’ll sometimes get into a <a href="https://deprogrammaticaipsum.com/james-coplien/">Coplien</a>-esque funk of “I don’t wanna write Classes. I want to write <em>Objects</em>!”. I don’t want to negotiate an industrial-relations policy for instances of Person in the current scope. I want to imagine the joy and misery Alice and Bob will experience working together right now.</p>

<p>I was thinking of that recently when <a href="https://www.reddit.com/r/ruby/comments/10sooyr/comment/j74j5qw/?utm_source=reddit&amp;utm_medium=web2x&amp;context=3">commenting on Reddit</a> about Caleb Hearth’s <a href="https://calebhearth.com/decree">“The Decree Design Pattern”</a>. Which ended up in the superset of these two thoughts:</p>

<ul>
  <li>heck yeah! if it’s globally distinct it should be globally referenceable</li>
  <li>oh, oh no, I don’t like looking at <em>that</em> particular Ruby code</li>
</ul>

<p>This was my comment to try to personally come to terms with those thoughts, iteratively:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># a consistent callable</span>
<span class="n">my_decree</span> <span class="o">=</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="n">do_something</span> <span class="p">}</span>

<span class="c1"># ok, but globally scoped</span>
<span class="no">MY_DECREE</span> <span class="o">=</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="n">do_something</span> <span class="p">}</span>

<span class="c1"># ok, but without the shouty all-caps</span>
<span class="k">module</span> <span class="nn">MyDecree</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">call</span> 
    <span class="n">do_something</span> 
  <span class="k">end</span> 
<span class="k">end</span>

<span class="c1"># ok, but what about when it gets really complex</span>
<span class="k">class</span> <span class="nc">MyDecree</span> 
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">call</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span>
    <span class="n">new</span><span class="p">(</span><span class="n">variable</span><span class="p">).</span><span class="nf">call</span> 
  <span class="k">end</span>
  
  <span class="k">def</span> <span class="nf">new</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span>
    <span class="vi">@variable</span> <span class="o">=</span> <span class="n">variable</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">call</span>
    <span class="n">do_something</span>
    <span class="n">do_something_else</span><span class="p">(</span><span class="vi">@variable</span><span class="p">)</span>
    <span class="n">do_even_more</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">do_even_more</span>
    <span class="c1"># something really complicated....</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>From the outside, <em>object</em> perspective, these are all have the same interchangeable interface (<code class="language-plaintext highlighter-rouge">.call</code>), and except for the first one, accessible everywhere. That’s great, from my perspective! Though I guess it’s a pretty short blog post to say:</p>

<ul>
  <li>Decrees are globally discrete and call-able objects</li>
  <li>The implementation is up to you!</li>
</ul>

<p>Unfortunately, the moment the internals come into play, it gets messy. But I don’t think that should take away from the external perspective.</p>


  </div>
</article>

    

    <hr>
  
    
      

<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">
      <a class="post-link" href="/2023/02/slop-and-call"><p>Slop and call</p>
</a>
    </h1>
    <p class="post-meta text-muted">
      <time datetime="2023-02-13T04:34:00+00:00" itemprop="datePublished">February 13, 2023</time>
      
      



    </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>In my role as Engineering Manager, I frequently play <em>Keeper of the Process</em>. Having worked effectively alongside plenty of agile <code class="language-plaintext highlighter-rouge">#noplanning</code> people (RIP Andrew), and carrying the scars of dysfunctional processes (oh, PRDs and OGSM), it feels historically out of character to lean into OKR scores and target dates. And I think I’ve made my peace with it.</p>

<p>When I was in high school, my friend’s dad Gary (RIP Gary) retired and bought a championship pool table. The pool table went in their living room and everything else came out. Nothing else fit. The room was a pool table and a stero, which Gary kept tuned to classic jazz. We played a lot of pool and listened to a lot of Charles Mingus.</p>

<p>The two games I remember playing most was 2-ball “English” and 9-ball. English is a “called” game; you have to say which ball and hole you’re aiming for before making the shot. 9-ball is played “slop”, as long as you hit the lowest-numbered ball first, it doesn’t matter which ball goes into which hole.</p>

<p>Both games have their techniques. Playing English I got really good at fine ball handling and putting a sidespin on the ball (that’s the “English”) and having a narrow intent. With 9-ball, I learned to do a lot of what we call a “textbook”-shot (I dunno why we gave only this one shot that name; we were 17). The shot was to bounce the ball off of as many alternating rails as possible until the ball eventually walked itself into a pocket. Just slam it really.</p>

<p>The point is, both of them were ok ways to play. They were just different. It’s fine.</p>

  </div>
</article>

    

    <hr>
  
    
      

<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">
      <a class="post-link" href="/2023/02/prevent-cdn-poisoning-from-fat-get-head-requests-in-ruby-on-rails"><p>Prevent CDN poisoning from Fat GET/HEAD Requests in Ruby on Rails</p>
</a>
    </h1>
    <p class="post-meta text-muted">
      <time datetime="2023-02-12T20:32:00+00:00" itemprop="datePublished">February 12, 2023</time>
      
      


  

  

  • Tagged <a href="/tags/#rails">rails</a>


    </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>There are many different flavors of <a href="https://portswigger.net/research/web-cache-entanglement">web cache poisoning discovered by Security Researcher James Kettle</a>. Read on for an explanation of one I’ve run across…</p>

<p><strong>What is a Fat GET/HEAD Request?</strong> A GET or HEAD request is “fat” when it has a request body. It’s unexpected! Typically one sees a request body with a POST or PUT request because the body contains form data. The HTTP specification says that including a request body with GET or HEAD requests is <a href="https://stackoverflow.com/a/983458"><em>undefined</em></a>. You can do it, and it’s up to the application to figure out what that means. Sometimes it’s bad!</p>

<p>You can get a sense of the applications that intentionally support Fat Requests (and how grumpy it makes some people) by reading through this <a href="https://github.com/postmanlabs/postman-app-support/issues/131">Postman issue</a>.</p>

<p><strong>Fat Requests can lead to CDN and cache poisoning in Rails.</strong> CDNs and caching web proxies (like Varnish) are frequently configured to cache the response from a GET or HEAD request based solely on the request’s URL and not the contents of the request body (they don’t cache POSTs or PUTs at all). If an application isn’t deliberately handling the request body, it may cause unexpected content to be cached and served.</p>

<p>For example, you have a <code class="language-plaintext highlighter-rouge">/search</code> endpoint:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">GET /search</code> shows a landing page with some explanatory content</li>
  <li><code class="language-plaintext highlighter-rouge">GET /search?q=foo</code> shows the search results for “foo”.</li>
  <li>
    <p>Here’s what a Fat Request looks like:</p>

    <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET /search     &lt;== the url for the landing page

q=verybadstuff  &lt;== oh, but with a request body
</code></pre></div>    </div>
  </li>
</ul>

<p>In a Rails Controller, <code class="language-plaintext highlighter-rouge">parameters</code> (alias <code class="language-plaintext highlighter-rouge">params</code>) merges query parameters (that’s the URL values) with request parameters (that’s the body values) into a single data structure. If your controller uses the presence of <code class="language-plaintext highlighter-rouge">params[:q]</code> to determine whether to show the landing page or the search results, it’s possible that when someone sends that Fat Request, your CDN may cache and subsequently serve the results for <code class="language-plaintext highlighter-rouge">verybadstuff</code> every time someone visits the <code class="language-plaintext highlighter-rouge">/search</code> landing page. That’s bad!</p>

<p>Here’s how to Curl it:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-XGET</span> <span class="nt">-H</span> <span class="s2">"Content-Type: application/x-www-form-urlencoded"</span> <span class="nt">-d</span> <span class="s2">"q=verybadstuff"</span> http://localhost:3000/search
</code></pre></div></div>

<p>Here are 3 ways to fix it…</p>

<h2 id="solution-1-fix-at-the-cdn">Solution #1: Fix at the CDN</h2>

<p>The most straightforward place to fix this should be at the caching layer, but it’s not always easy.</p>

<p>With Cloudflare, you could rewrite the GET request’s <code class="language-plaintext highlighter-rouge">Content-Type</code> header if it is <code class="language-plaintext highlighter-rouge">application/x-www-form-urlencoded</code> or <code class="language-plaintext highlighter-rouge">multipart/form-data</code>. Or use a Cloudflare Worker to drop the request body.</p>

<p>Varnish makes it easy to drop the request body for any GET request.</p>

<p>Other CDNs or proxies may be easier or more difficult. It depends!</p>

<p>Update via <a href="https://github.com/Mr0grog">Mr0grog</a>: AWS Cloudfront returns a <a href="https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/RequestAndResponseBehaviorCustomOrigin.html#RequestCustom-get-body">403 by default</a>.</p>

<h2 id="solution-2-deliberately-use-query_parameters">Solution #2: Deliberately use <code class="language-plaintext highlighter-rouge">query_parameters</code></h2>

<p>Rails provides three different methods for accessing parameters:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">query_parameters</code> for the values in the request URL</li>
  <li><code class="language-plaintext highlighter-rouge">request_parameters</code> ) for the values in the request body</li>
  <li><code class="language-plaintext highlighter-rouge">parameters</code> (alias <code class="language-plaintext highlighter-rouge">params</code>) for the problematic combination of them both. Values in <code class="language-plaintext highlighter-rouge">query_parameters</code> take precedence over values in <code class="language-plaintext highlighter-rouge">request_parameters</code> when they are merged together.</li>
</ul>

<p>Developers could be diligent and make sure to only use <code class="language-plaintext highlighter-rouge">query_parameters</code> in <code class="language-plaintext highlighter-rouge">#index</code> or <code class="language-plaintext highlighter-rouge">#show</code> , or <code class="language-plaintext highlighter-rouge">get</code> routed actions. Here’s an example from the <a href="https://github.com/git/git-scm.com/issues/1551"><code class="language-plaintext highlighter-rouge">git-scm</code> project</a>.</p>

<h2 id="solution-3-patch-rails">Solution #3: Patch Rails</h2>

<p>Changes were <a href="https://github.com/rails/rails/issues/39974">proposed in Rails</a> to not have <code class="language-plaintext highlighter-rouge">parameters</code> merge in the body values for GET and HEAD requests; it was rejected because it’s more a problem with the upstream cache than it is with Rails.</p>

<p>You can patch your own version of Rails. Here’s an example that patches the method in <a href="https://github.com/rails/rails/blob/21a3b52ba0b7d94b4903e02b6ac537a7d1d1c817/actionpack/lib/action_dispatch/http/parameters.rb#L49-L63"><code class="language-plaintext highlighter-rouge">ActionDispatch::Request</code></a>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># config/initializers/sanitize_fat_requests.rb</span>
<span class="k">module</span> <span class="nn">SanitizeFatRequests</span>
  <span class="k">def</span> <span class="nf">parameters</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">get_header</span><span class="p">(</span><span class="s2">"action_dispatch.request.parameters"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">params</span> <span class="k">if</span> <span class="n">params</span>

    <span class="k">if</span> <span class="n">get?</span> <span class="o">||</span> <span class="n">head?</span>
      <span class="n">params</span> <span class="o">=</span> <span class="n">query_parameters</span><span class="p">.</span><span class="nf">dup</span>
      <span class="n">params</span><span class="p">.</span><span class="nf">merge!</span><span class="p">(</span><span class="n">path_parameters</span><span class="p">)</span>
      <span class="n">set_header</span><span class="p">(</span><span class="s2">"action_dispatch.request.parameters"</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
      <span class="n">params</span>
    <span class="k">else</span>
      <span class="k">super</span>
    <span class="k">end</span>
  <span class="k">end</span>
  <span class="k">alias</span> <span class="ss">:params</span> <span class="ss">:parameters</span>
<span class="k">end</span>

<span class="no">ActionDispatch</span><span class="o">::</span><span class="no">Request</span><span class="p">.</span><span class="nf">include</span><span class="p">(</span><span class="no">SanitizeFatRequests</span><span class="p">)</span>

<span class="c1"># Some RSpec tests to verify this</span>
<span class="nb">require</span> <span class="s1">'rails_helper'</span>

<span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span> <span class="no">SanitizeFatRequests</span><span class="p">,</span> <span class="ss">type: :request</span> <span class="k">do</span>
  <span class="n">it</span> <span class="s1">'does not merge body params in GET requests'</span> <span class="k">do</span>
    <span class="n">get</span> <span class="s2">"/search"</span><span class="p">,</span> <span class="ss">headers: </span><span class="p">{</span><span class="s1">'CONTENT_TYPE'</span> <span class="o">=&gt;</span> <span class="s1">'application/x-www-form-urlencoded'</span><span class="p">},</span> <span class="ss">env: </span><span class="p">{</span><span class="s1">'rack.input'</span><span class="p">:</span> <span class="no">StringIO</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s1">'q=verybadstuff'</span><span class="p">)</span> <span class="p">}</span>

    <span class="c1"># verify that the request is correctly shaped because</span>
    <span class="c1"># the test helpers don't expect this kind of request</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="nf">request_parameters</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="s2">"q"</span> <span class="o">=&gt;</span> <span class="s2">"verybadstuff"</span><span class="p">)</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="nf">parameters</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">({</span><span class="s2">"action"</span><span class="o">=&gt;</span><span class="s2">"panlexicon"</span><span class="p">,</span> <span class="s2">"controller"</span><span class="o">=&gt;</span><span class="s2">"search"</span><span class="p">})</span>

    <span class="c1"># the behavioral expectation</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="nf">body</span><span class="p">).</span><span class="nf">not_to</span> <span class="kp">include</span> <span class="s2">"verybadstuff"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>


  </div>
</article>

    

    <hr>
  
    
      

<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">
      <a class="post-link" href="/2023/02/introducing-goodjob-bulk-and-batch"><p>Introducing GoodJob Bulk and Batch</p>
</a>
    </h1>
    <p class="post-meta text-muted">
      <time datetime="2023-02-05T22:37:00+00:00" itemprop="datePublished">February 5, 2023</time>
      
      


  

  

  • Tagged <a href="/tags/#goodjob">GoodJob</a>


    </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>GoodJob is a multithreaded, Postgres-based, ActiveJob backend for Ruby on Rails. I recently released two new features:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">GoodJob::Bulk</code> to optimize enqueuing large numbers of jobs (released in GoodJob v3.9)</li>
  <li><code class="language-plaintext highlighter-rouge">GoodJob::Batch</code> to coordinate parallelized sets of jobs (released in GoodJob v3.10)</li>
</ul>

<p>Big thanks to @julik, @mollerhoj, @v2kovac, @danielwestendorf, @jrochkind, @mperham and others for your help and counsel!</p>

<h3 id="bulk-enqueue">Bulk enqueue</h3>

<p><a href="https://github.com/bensheldon/good_job#bulk-enqueue">GoodJob’s Bulk-enqueue functionality</a> can buffer and enqueue multiple jobs at once, using a single INSERT statement. This can be more performant when enqueuing a large number of jobs.</p>

<p>I was inspired by a discussion within a Rails pull request to implement <a href="https://github.com/rails/rails/pull/46603"><code class="language-plaintext highlighter-rouge">perform_all_later</code> within Active Job</a>. I wanted to both support the way most people enqueue Active Job jobs with <code class="language-plaintext highlighter-rouge">perform_later</code> and also <a href="https://github.com/rails/rails/pull/43434">encourage people to work directly with Active Job instances too</a>.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># perform_later within a block</span>
<span class="n">active_jobs</span> <span class="o">=</span> <span class="no">GoodJob</span><span class="o">::</span><span class="no">Bulk</span><span class="p">.</span><span class="nf">enqueue</span> <span class="k">do</span>
  <span class="no">MyJob</span><span class="p">.</span><span class="nf">perform_later</span>
  <span class="no">AnotherJob</span><span class="p">.</span><span class="nf">perform_later</span>
<span class="k">end</span>
<span class="c1"># or with Active Job instances</span>
<span class="n">active_jobs</span> <span class="o">=</span> <span class="p">[</span><span class="no">MyJob</span><span class="p">.</span><span class="nf">new</span><span class="p">,</span> <span class="no">AnotherJob</span><span class="p">.</span><span class="nf">new</span><span class="p">]</span>
<span class="no">GoodJob</span><span class="o">::</span><span class="no">Bulk</span><span class="p">.</span><span class="nf">enqueue</span><span class="p">(</span><span class="n">active_jobs</span><span class="p">)</span>
</code></pre></div></div>

<p>Releasing Bulk functionality was a two-step: I initially implemented it while working on Batch functionality, and then with @julik’s initiative and help, we extracted and polished it to be used on its own.</p>

<h3 id="batches">Batches</h3>

<p><a href="https://github.com/bensheldon/good_job#batches">GoodJob’s Batch functionality</a> coordinates parallelized sets of jobs. The ability to coordinate a set of jobs, and run callbacks during lifecycle events, has been a highly demanded feature. Most people who talked to me about job batches were familiar with <a href="https://sidekiq.org/products/pro.html">Sidekiq Pro</a> ‘s <a href="https://github.com/mperham/sidekiq/wiki/Batches]">batch functionality</a>, which I didn’t want to simply recreate (Sidekiq Pro is excellent!). So I’ve been collecting use cases and thinking about what’s most in the spirit of Rails, Active Job, and Postgres:</p>

<ul>
  <li>Batches are mutable, database-backed objects with foreign-key relationships to sets of job records.</li>
  <li>Batches have  <code class="language-plaintext highlighter-rouge">properties</code> which use Active Job’s serializer, so they can contain and rehydrate any GlobalID object, like Active Record models.</li>
  <li>Batches have callbacks, which are themselves Active Job jobs</li>
</ul>

<p>Here’s a simple example:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">GoodJob</span><span class="o">::</span><span class="no">Batch</span><span class="p">.</span><span class="nf">enqueue</span><span class="p">(</span><span class="ss">on_finish: </span><span class="no">MyBatchCallbackJob</span><span class="p">,</span> <span class="ss">user: </span><span class="n">current_user</span><span class="p">)</span> <span class="k">do</span>
  <span class="no">MyJob</span><span class="p">.</span><span class="nf">perform_later</span>
  <span class="no">OtherJob</span><span class="p">.</span><span class="nf">perform_later</span>
<span class="k">end</span>

<span class="c1"># When these jobs have finished, it will enqueue your `MyBatchCallbackJob.perform_later(batch, options)`</span>
<span class="k">class</span> <span class="nc">MyBatchCallbackJob</span> <span class="o">&lt;</span> <span class="no">ApplicationJob</span>
  <span class="c1"># Callback jobs must accept a `batch` and `params` argument</span>
  <span class="k">def</span> <span class="nf">perform</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="c1"># The batch object will contain the Batch's properties, which are mutable</span>
    <span class="n">batch</span><span class="p">.</span><span class="nf">properties</span><span class="p">[</span><span class="ss">:user</span><span class="p">]</span> <span class="c1"># =&gt; &lt;User id: 1, ...&gt;</span>
    <span class="c1"># Params is a hash containing additional context (more may be added in the future)</span>
    <span class="n">params</span><span class="p">[</span><span class="ss">:event</span><span class="p">]</span> <span class="c1"># =&gt; :finish, :success, :discard</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>There’s more depth and examples in the <a href="https://github.com/bensheldon/good_job#batches">GoodJob Batch documentation</a>.</p>

<h3 id="please-help">Please help!</h3>

<p>Batches are definitely a work in progress, and I’d love your feedback:</p>

<ul>
  <li>What is the Batch functionality missing? Tell me your use cases.</li>
  <li>Help improve the <a href="https://goodjob-demo.herokuapp.com/good_job/jobs">Web Dashboard UI</a> (it’s rough but functional!)</li>
  <li>Find bugs! I’m sure there are some edge cases I overlooked.</li>
</ul>

  </div>
</article>

    

    <hr>
  
    
      

<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">
      <a class="post-link" href="/2023/01/framing-open-source-contributions-at-work"><p>Framing open source contributions at work</p>
</a>
    </h1>
    <p class="post-meta text-muted">
      <time datetime="2023-01-27T00:51:00+00:00" itemprop="datePublished">January 27, 2023</time>
      
      



    </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>Excerpts from the excellent RailsConf 2022 keynote: <a href="https://www.youtube.com/watch?v=MbqJzACF-54">The Success of Ruby on Rails by Eileen Uchitelle</a> [reformatted from the transcript]:</p>

<blockquote>

  <p>Upgrading is one of the easiest ways to find an area of Rails that can benefit from your contributions.  Fixing an issue in a recent release has a high likelihood of being merged.</p>

  <p>Running off Rails Main is another way to find contributions to Rails.  If you don’t want to run your Main in production,   you could run it in a separate CI build.  Shopify, GitHub and Basecamp run it.</p>

  <p>Running off Main may be harder than running off a release because features and bug fixes are  a little in flux sometimes. If you are running  off of Main, a feature added to the Main branch could be removed without deprecation. This is a worthwhile risk to take on because it lowers the overall risk of an upgrade.  When you run off Main, you’re less likely to fall behind upgrading because it becomes  part of your weekly or monthly maintenance.  Upgrading becomes routine, second nature rather  than novel and scary. Changes are easy to isolate. It’s just slightly less polished. Like I  said, I still think it’s pretty stable.</p>

  <p>Another way to find places to contribute  is look at your own applications.</p>

  <ul>
    <li>Do you have monkey patches on Rails code  that are fixes bugs or changing behavior?   Instead of leaving them there, upstream  the fix and delete the monkey patch.</li>
    <li>Is there infrastructure level code that  doesn’t really pertain to your product? It’s possible this could be a great addition to  Rails. When I wrote the database in Rails, it came from GitHub’s monolith. It made perfect sense  because it was getting in the way of upgrades, didn’t expose any intellectual property, had  nothing to do with your product features and<br />
something many applications could benefit from.</li>
    <li>Lastly and most importantly, keep showing up.</li>
  </ul>

  <p>… Ultimately,  if more companies treated the framework as an extension of the application, it would  result in higher resilience and stability. Investment in Rails ensures your foundation will not crumble under the weight of your application. Treating it as an unimportant part of your application is a mistake and many, many leaders make this mistake.</p>

  <p>…leaders see funding open source risky is because they don’t actually  understand the work. … Often, leaders worry if there’s a team working in open source, other teams are going to be jealous or resentful that that team is doing “fun” work. …</p>

  <p>Maintainers need to make changes, deal with security incidents and also handle criticism from many people. Maintaining and contributing to open source requires a different skill set than product work. That doesn’t make it any less essential.</p>

  <p>…Many product companies don’t like words like “research” and “experimental.”  They can imply work without goals. Use words like  “investment.” And demonstrate the direct value will bring. Make sure it is measurable and will  make the application and product more successful. A great example of measurable work is  a change that improves performance. If you can tie contributions to direct customer improvements, it’s easier to show leadership.</p>

  <p>…As I started contributing more and more  and pealing back the layers of Rails, the impact is limitless. I started looking at how applications stretched  the boundaries of what Rails was meant to do.</p>

  <p>…Ultimately, I want you to contribute to Rails because it’s going to enable you to build a better company and product. The benefits of investing in Rails go far beyond improving the framework.</p>

  <p>Investing in Rails will build up the skills of your engineering team. They will developer better communication skills, learn to navigate criticism,  debugging skills and how the framework functions.  It will teach engineers about the inner-workings and catch bugs.</p>

  <p>Monkey patching is far more dangerous than I think most realize. They break  with upgrades and cause security incidents.  When you write a monkey patch, you maintain a portion of Rails code. Wouldn’t it have been   better to patch it upstream rather than taking on that risk and responsibility.</p>

  <p>It will give your engineering team the skills  they need to make better technical decisions. You’re ensuring that Rails benefits your application and the company for the long-term.</p>

  <p>…Contributing to Rails is only <em>not</em> essential if you don’t care about the direction the framework is headed in. We should be contributing  because we care about the changes.</p>

  <p>We want to ensure our apps are upgradeable, performant and stable.</p>

  <p>Investment in Rails also means you won’t have to rewrite your application in a few years because Rails no longer supports what you need. When you fail  to invest in your tools, you end up being unable to upgrade. Your engineering team is miserable. The codebase is a mess and writing features is impossible. You’re forced into a rewrite, your engineers want to write Rails and you can no longer let them do that. You have to build a bunch of features before you site falls over.</p>

  <p>It’s not Rails’ fault you made  the decision to invest elsewhere.</p>

  <p>If you build contributing into your culture, the benefits are clear:</p>

  <ul>
    <li>Your engineering teams’ skills will improve.</li>
    <li>Rails will evolve with your  application because you’re helping decide how it needs to change.</li>
    <li>Your application will be  more resilient because there’s low tech debt and your foundation is stable. Active investment  prevents your application from degrading.</li>
  </ul>

  <p>Building a team to invest in Rails is  proactive. Rewriting an application is reactive. Which one do you think is better for business in the long run?</p>

</blockquote>

  </div>
</article>

    

    
  

  
<hr>


<nav aria-label="Page navigation">
  <ul class="pagination justify-content-center">
    
      <li class="page-item"><a href="/page/2/" class="page-link"><span aria-hidden="true">&larr; </span>Newer</a></li>
    

    <li class="page-item disabled"><span class="page-link">Page 3 of 67</span></li>

    
      <li class="page-item"><a href="/page/4/" class="page-link">Older<span aria-hidden="true"> &rarr;</span></a></li>
    
  </ul>
</nav>



</div>

    </div>

    <footer class="site-footer">

</footer>


  </body>

</html>
