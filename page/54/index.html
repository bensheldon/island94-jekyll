<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Island94.org</title>
  <meta name="description" content="A Lost and Found
">

  <link rel="stylesheet" href="/assets/stylesheets/main.css">
  <script src="/assets/javascripts/main.js"></script>

  <link rel="canonical" href="https://island94.org/page/54/">

  <link rel="alternate" type="application/rss+xml" title="Island94.org Posts" href="https://island94.org/feed.xml">
  <link rel="alternate" type="application/rss+xml" title="Island94.org Book Reviews" href="https://island94.org/books.xml">

  
    <meta name="robots" content="noindex, follow">
  

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-870047-1', 'auto');
  ga('send', 'pageview');
</script>

</head>


  <body>

    <nav class="navbar navbar-expand-lg navbar-light bg-light mb-2 flex-column">
  <div class="container">
    <a class="navbar-brand" href="/">Island94.org</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item"><a class="nav-link " href="/about/">About</a></li>
        <li class="nav-item"><a class="nav-link " href="/archives/">Archives</a></li>
        <li class="nav-item"><a class="nav-link " href="/books/">Books</a></li>
        <li class="nav-item"><a class="nav-link " href="/tags/">Tags</a></li>

        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            Feeds <span class="fa fa-rss"></span>
          </a>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
            <li><a href="/feed.xml" class="dropdown-item">Everything RSS <span class="fa fa-rss"></span></a></li>
            <li><a href="/posts.xml" class="dropdown-item">Posts RSS <span class="fa fa-rss"></span></a></li>
            <li><a href="/books.xml" class="dropdown-item">Books RSS <span class="fa fa-rss"></span></a></li>
          </ul>
        </li>
      </ul>

      <form id="search" class="d-flex" action="/search" method="get">
        <input id="search-box" class="form-control search" role="search" name="q" placeholder="Search" aria-label="Search" results="0" type="text">
        <button class="sr-only" type="submit">Search</button>
      </form>
    </div>
  </div>
  <div class="container">
    <div class="text-muted fst-italic">
      — Ben Sheldon's personal blog and <a href="/2012/04/A-Commonplace-Book.html">commonplace book</a>.
    </div>
  </div>
</nav>


    <div class="container container-body">
      <div class="home">
  
    <hr>

<nav aria-label="Page navigation">
  <ul class="pagination justify-content-center">
    
      <li class="page-item"><a href="/page/53/" class="page-link"><span aria-hidden="true">&larr; </span>Newer</a></li>
    

    <li class="page-item"><span class="page-link active">Page 54 of 64</span></li>

    
      <li class="page-item"><a href="/page/55/" class="page-link">Older<span aria-hidden="true"> &rarr;</span></a></li>
    
  </ul>
</nav>

  

  
    

<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">
      <a class="post-link" href="/2007/08/Geekout-Video-on-Maps-for-Cable-Access-TV.html">Geekout: Video on Maps for Cable Access TV</a>
    </h1>
    <p class="post-meta text-muted">
      <time datetime="2007-08-02T00:00:00+00:00" itemprop="datePublished">August 2, 2007</time>
      
      


  

  

  • Tagged <a href="/tags/#Cable_Access">Cable Access</a>, <a href="/tags/#coding">coding</a>, <a href="/tags/#development">development</a>, <a href="/tags/#Drupal">Drupal</a>, <a href="/tags/#geekout">geekout</a>, <a href="/tags/#navigation">navigation</a>, <a href="/tags/#portfolio">portfolio</a>, and <a href="/tags/#video">video</a>


    </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p><img src="/uploads/2007-08/mediamap-600x448.jpg" alt="" title="mediamap" /></p>

<p>I recently did some <a href="http://drupal.org">Drupal</a> development work for <a href="http://cctvcambridge.org">Cambridge Community Television</a>. As part of the really amazing work they are doing combining new media with traditional <a href="http://alliancecm.org">Cable Access Television</a>, CCTV has been mapping videos their members produce. They call this project the <a href="http://cctvcambridge.org/mediamap">Mediamap</a>.</p>

<p>I was really excited to work on the Mediamap with CCTV because of my long <a href="http://island94.org/articles/future-cable-access">involvement</a> with Cable Access Television, most notably the now-defunct <a href="https://web.archive.org/web/20070712053537/http://digitalbicycle.org/">DigitalBicycle Project</a> and the community maintained directory of Cable Access Stations I built and administer: <a href="https://web.archive.org/web/20070819093518/http://www.mappingaccess.com/">MappingAccess.com</a>.</p>

<p>Despite CCTV running their website on Drupal, their first proof-of-concept version of the Mediamap was created manually, using the very capable <a href="http://mapbuilder.net">Mapbuilder.net</a> service and copy-and-pasted embedded flash video. While simple from a technological standpoint, they were running to problems optimizing the workflow of updating the map; changes had to be made via the Mapbuilder.net interface, with a single username and password, then manually parsed to remove some coding irregularities, and finally copy and pasted whole into a page on their website.</p>

<p>I was asked to improve the workflow and ultimately take fuller advantage of Drupal’s built-in user management and content management features. For instance, taking advantage of CCTV’s current member submitted video capabilities and flowing them into the map as an integrated report, not a separate and parallel system.</p>

<p>In my discussions with them, a couple of issues came up. Foremost was that CCTV was running an older version of Drupal: 4.7. While still quite powerful, many newer features and contributed modules were not available for this earlier release. The current version of Drupal, 5.1, has many rich, well-developed utilities for creating reports and mapping them: <a href="http://drupal.org/project/cck">Content Construction Kit (CCK)</a> + <a href="http://drupal.org/project/views">Views</a> + <a href="http://drupal.org/project/gmap">Gmap</a> + <a href="http://drupal.org/project/location">Location</a>. As it was though, with the older version, I would have to develop the additional functionality manually.</p>

<p>The following is a description, with code examples, of the functionality I created for the Mediamap. Additionally, following this initial development, CCTV upgraded their Drupal installation to 5.1, giving me the opportunity to demonstrate the ease and power of Drupal’s most recent release—rendering blissfully obsolete most of the custom coding I had done.</p>

<p>Location and Gmap was used in both versions for storing geographic data and hooking into the Google Map API. One of Drupal’s great strengths is the both the diversity of contributed modules, and the flexibility with which a developer can use them.</p>

<h3 id="adding-additional-content-fields">Adding additional content fields</h3>

<p>CCTV already has a process in which member’s can submit content nodes. In 4.7, the easiest way to add additional data fields to these was with a custom <a href="http://api.drupal.org/api/file/nodeapi_example.module/4.7">NodeAPI module</a>. CCTV was interested in using embedded flash video, primarily from <a href="http://blip.tv">Blip.tv</a>, but also Google Video or YouTube if the flexibility was needed. To simplify the process, we decided on just adding the cut-and-paste embed code to a custom content field in existing nodes.</p>

<p>To do this, I created a new module that invoked hook_nodeapi:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">/</span><span class="err">\</span><span class="o">*</span><span class="err">\</span><span class="o">*</span><span class="err">\</span> <span class="o">*</span> <span class="nc">Implementation</span> <span class="n">of</span> <span class="n">hook_nodeapi</span><span class="err">\</span> <span class="o">*</span> <span class="o">/</span>

<span class="k">function</span> <span class="n">cambridge_mediamap_nodeapi</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$node</span><span class="p">,</span> <span class="nv">$op</span><span class="p">,</span> <span class="nv">$teaser</span><span class="p">,</span> <span class="nv">$page</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="nv">$op</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s1">'validate'</span><span class="o">:</span>
      <span class="k">if</span> <span class="p">(</span><span class="nf">variable_get</span><span class="p">(</span><span class="s1">'cambridge_mediamap_'</span><span class="mf">.</span><span class="nv">$node</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">type</span><span class="p">,</span> <span class="kc">TRUE</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nf">user_access</span><span class="p">(</span><span class="s1">'modify node data'</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nv">$node</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">cambridge_mediamap</span><span class="p">[</span><span class="s1">'display'</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nv">$node</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">cambridge_mediamap</span><span class="p">[</span><span class="s1">'embed'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">''</span><span class="p">)</span> <span class="p">{</span>
            <span class="nf">form_set_error</span><span class="p">(</span><span class="s1">'cambridge_mediamap'</span><span class="p">,</span> <span class="nf">t</span><span class="p">(</span><span class="s1">'Media Map: You must enter embed code or disable display of this node on the map'</span><span class="p">));</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="s1">'load'</span><span class="o">:</span>
      <span class="nv">$object</span> <span class="o">=</span> <span class="nf">db_fetch_object</span><span class="p">(</span><span class="nf">db_query</span><span class="p">(</span><span class="s1">'SELECT display, embed FROM {cambridge_mediamap} WHERE nid = %d'</span><span class="p">,</span> <span class="nv">$node</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">nid</span><span class="p">));</span>
      <span class="nv">$embed</span> <span class="o">=</span> <span class="nv">$object</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">embed</span><span class="p">;</span>
      <span class="nv">$embed_resize</span> <span class="o">=</span> <span class="nf">cambridge_mediamap_resize</span><span class="p">(</span><span class="nv">$embed</span><span class="p">);</span>
      <span class="k">return</span> <span class="k">array</span><span class="p">(</span><span class="s1">'cambridge_mediamap'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'display'</span> <span class="o">=&gt;</span> <span class="nv">$object</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">display</span><span class="p">,</span> <span class="s1">'embed'</span> <span class="o">=&gt;</span> <span class="nv">$embed</span><span class="p">,</span> <span class="s1">'embed_resize'</span> <span class="o">=&gt;</span> <span class="nv">$embed_resize</span><span class="p">,</span> <span class="p">));</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="s1">'insert'</span><span class="o">:</span>
      <span class="nf">db_query</span><span class="p">(</span><span class="s2">"INSERT INTO </span><span class="si">{</span><span class="nv">cambridge_mediamap</span><span class="si">}</span><span class="s2"> (nid, display, embed) VALUES (%d, %d, '%s')"</span><span class="p">,</span> <span class="nv">$node</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">nid</span><span class="p">,</span> <span class="nv">$node</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">cambridge_mediamap</span><span class="p">[</span><span class="s1">'display'</span><span class="p">],</span> <span class="nv">$node</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">cambridge_mediamap</span><span class="p">[</span><span class="s1">'embed'</span><span class="p">]);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="s1">'update'</span><span class="o">:</span>
      <span class="nf">db_query</span><span class="p">(</span><span class="s1">'DELETE FROM {cambridge_mediamap} WHERE nid = %d'</span><span class="p">,</span> <span class="nv">$node</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">nid</span><span class="p">);</span>
      <span class="nf">db_query</span><span class="p">(</span><span class="s2">"INSERT INTO </span><span class="si">{</span><span class="nv">cambridge_mediamap</span><span class="si">}</span><span class="s2"> (nid, display, embed) VALUES (%d, %d, '%s')"</span><span class="p">,</span> <span class="nv">$node</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">nid</span><span class="p">,</span> <span class="nv">$node</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">cambridge_mediamap</span><span class="p">[</span><span class="s1">'display'</span><span class="p">],</span> <span class="nv">$node</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">cambridge_mediamap</span><span class="p">[</span><span class="s1">'embed'</span><span class="p">]);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="s1">'delete'</span><span class="o">:</span>
      <span class="nf">db_query</span><span class="p">(</span><span class="s1">'DELETE FROM {cambridge_mediamap} WHERE nid = %d'</span><span class="p">,</span> <span class="nv">$node</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">nid</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span><span class="err">  </span>
    <span class="k">case</span> <span class="s1">'view'</span><span class="o">:</span>
      <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>As you can see, there is a considerable amount of coding required, from defining the form, validating input and configuring database storage and retrieval calls.</p>

<p>Now that we have the glue for the custom field, we have to configure what node types that custom field appears on. Additionally, we need to set up administrative settings to configure where that custom field will appear, and lastly insert that field into the node edit screen:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="err">\</span><span class="o">**</span>
 <span class="o">*</span> <span class="nc">Implementation</span> <span class="n">of</span> <span class="n">hook_form_alter</span>
 <span class="o">*/</span>
<span class="k">function</span> <span class="n">cambridge_mediamap_nodeapi</span><span class="p">(</span> <span class="o">&amp;</span> <span class="nv">$node</span><span class="p">,</span> <span class="nv">$op</span><span class="p">,</span> <span class="nv">$teaser</span><span class="p">,</span> <span class="nv">$page</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="nv">$op</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s1">'validate'</span><span class="o">:</span>
      <span class="k">if</span> <span class="p">(</span><span class="nf">variable_get</span><span class="p">(</span><span class="s1">'cambridge_mediamap_'</span><span class="mf">.</span><span class="nv">$node</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">type</span><span class="p">,</span> <span class="kc">TRUE</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nf">user_access</span><span class="p">(</span><span class="s1">'modify node data'</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nv">$node</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">cambridge_mediamap</span><span class="p">[</span><span class="s1">'display'</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nv">$node</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">cambridge_mediamap</span><span class="p">[</span><span class="s1">'embed'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">''</span><span class="p">)</span> <span class="p">{</span>
            <span class="nf">form_set_error</span><span class="p">(</span><span class="s1">'cambridge_mediamap'</span><span class="p">,</span> <span class="nf">t</span><span class="p">(</span><span class="s1">'Media Map: You must enter embed code or disable display of this node on the map'</span><span class="p">));</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="s1">'load'</span><span class="o">:</span>
      <span class="nv">$object</span> <span class="o">=</span> <span class="nf">db_fetch_object</span><span class="p">(</span><span class="nf">db_query</span><span class="p">(</span><span class="s1">'SELECT display, embed FROM {cambridge_mediamap} WHERE nid = %d'</span><span class="p">,</span> <span class="nv">$node</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">nid</span><span class="p">));</span>
      <span class="nv">$embed</span> <span class="o">=</span> <span class="nv">$object</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">embed</span><span class="p">;</span>
      <span class="nv">$embed_resize</span> <span class="o">=</span> <span class="nf">cambridge_mediamap_resize</span><span class="p">(</span><span class="nv">$embed</span><span class="p">);</span>
      <span class="k">return</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">'cambridge_mediamap'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
          <span class="s1">'display'</span> <span class="o">=&gt;</span> <span class="nv">$object</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">display</span><span class="p">,</span>
          <span class="s1">'embed'</span> <span class="o">=&gt;</span> <span class="nv">$embed</span><span class="p">,</span>
          <span class="s1">'embed_resize'</span> <span class="o">=&gt;</span> <span class="nv">$embed_resize</span><span class="p">,</span>
        <span class="p">)</span>
      <span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="s1">'insert'</span><span class="o">:</span>
      <span class="nf">db_query</span><span class="p">(</span><span class="s2">"INSERT INTO </span><span class="si">{</span><span class="nv">cambridge_mediamap</span><span class="si">}</span><span class="s2"> (nid, display, embed) VALUES (%d, %d, '%s')"</span><span class="p">,</span> <span class="nv">$node</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">nid</span><span class="p">,</span> <span class="nv">$node</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">cambridge_mediamap</span><span class="p">[</span><span class="s1">'display'</span><span class="p">],</span> <span class="nv">$node</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">cambridge_mediamap</span><span class="p">[</span><span class="s1">'embed'</span><span class="p">]);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="s1">'update'</span><span class="o">:</span>
      <span class="nf">db_query</span><span class="p">(</span><span class="s1">'DELETE FROM {cambridge_mediamap} WHERE nid = %d'</span><span class="p">,</span> <span class="nv">$node</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">nid</span><span class="p">);</span>
      <span class="nf">db_query</span><span class="p">(</span><span class="s2">"INSERT INTO </span><span class="si">{</span><span class="nv">cambridge_mediamap</span><span class="si">}</span><span class="s2"> (nid, display, embed) VALUES (%d, %d, '%s')"</span><span class="p">,</span> <span class="nv">$node</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">nid</span><span class="p">,</span> <span class="nv">$node</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">cambridge_mediamap</span><span class="p">[</span><span class="s1">'display'</span><span class="p">],</span> <span class="nv">$node</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">cambridge_mediamap</span><span class="p">[</span><span class="s1">'embed'</span><span class="p">]);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="s1">'delete'</span><span class="o">:</span>
      <span class="nf">db_query</span><span class="p">(</span><span class="s1">'DELETE FROM {cambridge_mediamap} WHERE nid = %d'</span><span class="p">,</span> <span class="nv">$node</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">nid</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="s1">'view'</span><span class="o">:</span>
      <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>As you can see, that’s a lot of lines of code for what we essentially can do, in Drupal 5.1 with CCK. CCK allows you, graphically through the Drupal web-interface, to create a new content field and add it to a node type; it takes about a minute.</p>

<h3 id="building-the-map">Building the Map</h3>

<p>The primary goal of rebuilding the Mediamap using native Drupal was workflow optimization: it was frustrating to submit information both within Drupal and then recreate it within Mapbuilder. In essence, the map should be just another report of Drupal content: you may have a short bulleted list of the top five articles, a paginated history with teasers and author information, or a full-blown map, but most importantly, all of it is flowing dynamically out of the Drupal database.</p>

<p>The Gmap module provides many powerful ways to integrate the Google Map API with Drupal. While Gmap for 4.7 provides a default map of content it would not provide the features or customizability we desired with the Mediamap. Instead, one of the most powerful ways to use Gmap is to hook directly into the module’s own API-like functions:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>\**
 * A page callback to draw the map
 */

function cambridge_mediamap_map() {
  $output = '';
  //Collect the nodes to be displayed
  $results = db_query('SELECT embed, nid FROM {cambridge_mediamap} WHERE display = 1');
  //Initialize our marker array
  $markers = array();
  //check to see what modules are enabled
  $location_enabled = module_exist('location');
  $gmap_location_enabled = module_exist('gmap_location');
  //load each node and set it's attributes in the marker array
  while ($item = db_fetch_object($results)) {
    $latitude = 0;
    $longitude = 0;
    //load the node
    $node = node_load(array('nid' =&gt; $item - &gt; nid));
    //set the latitude and longitude
    //give location module data preference over gmap module data
    if ($location_enabled) {
      $latitude = $node - &gt; location['latitude'];
      $longitude = $node - &gt; location['longitude'];
    }
    elseif($gmap_location_enabled) {
      $latitude = $node - &gt; gmap_location_latitude;
      $longitude = $node - &gt; gmap_location_longitude;
    }
    if ($latitude &amp;&amp; $longitude) {
      $markers[] = array(
        'label' =&gt; theme('cambridge_mediamap_marker', $node),
        'latitude' =&gt; $latitude,
        'longitude' =&gt; $longitude,
        'markername' =&gt; variable_get('cambridge_mediamap_default_marker', 'marker'),
      );
    }
  }
  $latlon = explode(',', variable_get('cambridge_mediamap_default_latlong', '42.369452,-71.100426'));
  $map = array(
    'id' =&gt; 'cambridge_mediamap',
    'latitude' =&gt; trim($latlon[0]),
    'longitude' =&gt; trim($latlon[1]),
    'width' =&gt; variable_get('cambridge_mediamap_default_width', '100%'),
    'height' =&gt; variable_get('cambridge_mediamap_default_height', '500px'),
    'zoom' =&gt; variable_get('cambridge_mediamap_default_zoom', 13),
    'control' =&gt; variable_get('cambridge_mediamap_default_control', 'Large'),
    'type' =&gt; variable_get('cambridge_mediamap_default_type', 'Satellite'),
    'markers' =&gt; $markers,
  );
   
  return gmap_draw_map($map);
}
</code></pre></div></div>

<p>As you can see, this is quite complicated. Drupal 5.1 offers the powerful Views module, which allows one to define custom reports, once again graphically from the Drupal web-interface, in just a couple minutes of configuration. The gmap_views module, which ships with Gmap, allows one to add those custom reports to a Google Map, which is incredibly useful and renders obsolete much of the development work I did.</p>

<h3 id="on-displaying-video-in-maps">On displaying video in maps</h3>

<p>In my discussions with CCTV, we felt it most pragmatic to use the embedded video code provided by video hosting services such as Blip.tv. While we could have used one of the Drupal video modules, we wanted the ability to host video offsite due to storage constraints. While I was concerned about the danger of code injection via minimally validated inputs, we felt that this would be of small danger because the content would be maintained by CCTV staff and select members.</p>

<p>The markers were themed using the embedded video field pulled from the Drupal database, along with the title and a snippet of the description, all linking back to the full content node.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cd">/**
 * A theme function for our markers
 */</span>
<span class="k">function</span> <span class="n">theme_cambridge_mediamap_marker</span><span class="p">(</span><span class="nv">$node</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$output</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
  <span class="nv">$output</span><span class="mf">.</span> <span class="o">=</span> <span class="s1">''</span> <span class="mf">.</span> <span class="nf">l</span><span class="p">(</span><span class="nv">$node</span><span class="o">-&gt;</span><span class="n">title</span><span class="p">,</span> <span class="s1">'node / '</span> <span class="mf">.</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="n">nid</span><span class="p">)</span> <span class="mf">.</span> <span class="s1">''</span><span class="p">;</span>
  <span class="nv">$output</span><span class="mf">.</span> <span class="o">=</span> <span class="s1">''</span> <span class="mf">.</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="n">cambridge_mediamap</span><span class="p">[</span><span class="s1">' . embed_resize '</span><span class="p">]</span> <span class="mf">.</span> <span class="s1">''</span><span class="p">;</span>
  <span class="nv">$output</span><span class="mf">.</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
  <span class="k">return</span> <span class="nv">$output</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>With Drupal 5.1 and Views, we still had to override the standard marker themes, but this was simple and done through the standard methods.</p>

<p>One of the most helpful pieces was some code developed by <a href="http://circuitous.org">Rebecca White</a>, who I previously worked with on <a href="http://panlexicon.com">Panlexicon</a>. She provided the critical pieces of code that parsed the embedded video code and resized it for display on small marker windows.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cd">/**

\* Returns a resized embed code

\*/</span>
<span class="k">function</span> <span class="n">cambridge_mediamap_resize</span><span class="p">(</span><span class="nv">$embed</span> <span class="o">=</span> <span class="s1">''</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$embed</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">''</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">list</span><span class="p">(</span><span class="nv">$width</span><span class="p">,</span> <span class="nv">$height</span><span class="p">)</span> <span class="o">=</span> <span class="nf">cambridge_mediamap_get_embed_size</span><span class="p">(</span><span class="nv">$embed</span><span class="p">);</span>
  <span class="c1">//width/height ratio</span>
  <span class="nv">$width_to_height</span> <span class="o">=</span> <span class="nv">$width</span> <span class="o">/</span> <span class="nv">$height</span><span class="p">;</span>
  <span class="nv">$max_width</span> <span class="o">=</span> <span class="nf">variable_get</span><span class="p">(</span><span class="s1">'cambridge_mediamap_embed_width'</span><span class="p">,</span> <span class="s1">'320'</span><span class="p">);</span>
  <span class="nv">$max_height</span> <span class="o">=</span> <span class="nf">variable_get</span><span class="p">(</span><span class="s1">'cambridge_mediamap_embed_height'</span><span class="p">,</span> <span class="s1">'240'</span><span class="p">);</span>
  <span class="c1">//shrink down widths while maintaining proportion</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$width</span> <span class="o">&gt;=</span> <span class="nv">$height</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$width</span> <span class="o">&gt;</span> <span class="nv">$max_width</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$width</span> <span class="o">=</span> <span class="nv">$max_width</span><span class="p">;</span>
      <span class="nv">$height</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="nv">$width_to_height</span><span class="p">)</span><span class="err">\</span> <span class="o">*</span> <span class="nv">$width</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$height</span> <span class="o">&gt;</span> <span class="nv">$max_height</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$height</span> <span class="o">=</span> <span class="nv">$max_height</span><span class="p">;</span>
      <span class="nv">$width</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$width_to_height</span><span class="p">)</span><span class="err">\</span> <span class="o">*</span> <span class="nv">$height</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$height</span> <span class="o">&gt;</span> <span class="nv">$max_height</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$height</span> <span class="o">=</span> <span class="nv">$max_height</span><span class="p">;</span>
      <span class="nv">$width</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$width_to_height</span><span class="p">)</span><span class="err">\</span> <span class="o">*</span> <span class="nv">$height</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$width</span> <span class="o">&gt;</span> <span class="nv">$max_width</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$width</span> <span class="o">=</span> <span class="nv">$max_width</span><span class="p">;</span>
      <span class="nv">$height</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="nv">$width_to_height</span><span class="p">)</span><span class="err">\</span> <span class="o">*</span> <span class="nv">$width</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nf">cambridge_mediamap_set_embed_size</span><span class="p">(</span><span class="nv">$embed</span><span class="p">,</span> <span class="nb">intval</span><span class="p">(</span><span class="nv">$width</span><span class="p">),</span> <span class="nb">intval</span><span class="p">(</span><span class="nv">$height</span><span class="p">));</span>
<span class="p">}</span>
<span class="o">/</span><span class="err">\</span><span class="o">*</span><span class="err">\</span><span class="o">*</span><span class="err">\</span> <span class="o">*</span> <span class="n">find</span> <span class="n">out</span> <span class="n">what</span> <span class="n">size</span> <span class="n">the</span> <span class="n">embedded</span> <span class="n">thing</span> <span class="n">is</span><span class="err">\</span> <span class="o">*</span> <span class="o">/</span>

<span class="k">function</span> <span class="n">cambridge_mediamap_get_embed_size</span><span class="p">(</span><span class="nv">$html</span><span class="p">)</span> <span class="p">{</span>
  <span class="nb">preg_match</span><span class="p">(</span><span class="s1">'/]\*width(\s\*=\s\*"|:\s\*)(\d+)/i'</span><span class="p">,</span> <span class="nv">$html</span><span class="p">,</span> <span class="nv">$match_width</span><span class="p">);</span>
  <span class="nb">preg_match</span><span class="p">(</span><span class="s1">'/]\*height(\s\*=\s\*"|:\s\*)(\d+)/i'</span><span class="p">,</span> <span class="nv">$html</span><span class="p">,</span> <span class="nv">$match_height</span><span class="p">);</span>
  <span class="k">return</span> <span class="k">array</span><span class="p">(</span><span class="nv">$match_width</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nv">$match_height</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
<span class="p">}</span>
<span class="o">/</span><span class="err">\</span><span class="o">*</span><span class="err">\</span><span class="o">*</span><span class="err">\</span> <span class="o">*</span> <span class="n">set</span> <span class="n">the</span> <span class="n">size</span> <span class="n">of</span> <span class="n">the</span> <span class="n">embeded</span> <span class="n">thing</span><span class="err">\</span> <span class="o">*</span> <span class="o">/</span>

<span class="k">function</span> <span class="n">cambridge_mediamap_set_embed_size</span><span class="p">(</span><span class="nv">$html</span><span class="p">,</span> <span class="nv">$width</span><span class="p">,</span> <span class="nv">$height</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$html</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">'/(&lt;(embed|object)\s[^&gt;]\*width(\s\*=\s\*"|:\s\*))(\d+)/i'</span><span class="p">,</span> <span class="s1">'${1}'</span><span class="mf">.</span><span class="nv">$width</span><span class="p">,</span> <span class="nv">$html</span><span class="p">);</span>
  <span class="nv">$html</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">'/(&lt;(embed|object)\s[^&gt;]\*height(\s\*=\s\*"|:\s\*))(\d+)/i'</span><span class="p">,</span> <span class="s1">'${1}'</span><span class="mf">.</span><span class="nv">$height</span><span class="p">,</span> <span class="nv">$html</span><span class="p">);</span>
  <span class="k">return</span> <span class="nv">$html</span><span class="p">;</span>
<span class="p">}</span>
<span class="o">/</span><span class="err">\</span><span class="o">*</span><span class="err">\</span><span class="o">*</span><span class="err">\</span> <span class="o">*</span> <span class="n">returns</span> <span class="n">the</span> <span class="n">base</span> <span class="n">url</span> <span class="n">of</span> <span class="n">the</span> <span class="n">src</span> <span class="n">attribute</span><span class="mf">.</span><span class="err">\</span><span class="o">*</span><span class="n">youtube</span> <span class="o">=</span> <span class="n">www</span><span class="mf">.</span><span class="n">youtube</span><span class="mf">.</span><span class="n">com</span><span class="err">\</span> <span class="o">*</span> <span class="n">blip</span> <span class="o">=</span> <span class="n">blip</span><span class="mf">.</span><span class="n">tv</span><span class="err">\</span> <span class="o">*</span> <span class="n">google</span> <span class="n">video</span> <span class="o">=</span> <span class="n">video</span><span class="mf">.</span><span class="n">google</span><span class="mf">.</span><span class="n">com</span><span class="err">\</span> <span class="o">*</span> <span class="o">/</span>

<span class="k">function</span> <span class="n">cambridge_mediamap_get_embed_source</span><span class="p">(</span><span class="nv">$html</span><span class="p">)</span> <span class="p">{</span>
  <span class="nb">preg_match</span><span class="p">(</span><span class="s1">'/]\*src="http:\/\/([^\/"]+)/i'</span><span class="p">,</span> <span class="nv">$html</span><span class="p">,</span> <span class="nv">$match_src</span><span class="p">);</span>
  <span class="k">return</span> <span class="nv">$match_src</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="the-wrap-up">The Wrap-Up</h3>

<p>While it may not seem so from the lines of code above, developing for Drupal is still relatively easy. Drupal provides a rich set of features for developers, <a href="http://api.drupal.org">well documented features</a>, and strong <a href="http://drupal.org/coding-standards">coding standards</a>—making reading other people’s code and learning from it incredibly productive.</p>

<p>Below is the entirety of the custom module I developed for the 4.7 version of the CCTV Media Map. Because it was custom and intended to be used in-house, many important, release worthy functions were omitted, such as richer administrative options and module/function verifications.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s1">'cambridge_mediamap'</span><span class="p">,</span> <span class="s1">'title'</span> <span class="o">=&gt;</span> <span class="nf">t</span><span class="p">(</span><span class="s1">'Mediamap'</span><span class="p">),</span> <span class="s1">'callback'</span> <span class="o">=&gt;</span> <span class="s1">'cambridge_mediamap_map'</span><span class="p">,</span> <span class="s1">'access'</span> <span class="o">=&gt;</span> <span class="nf">user_access</span><span class="p">(</span><span class="s1">'access mediamap'</span><span class="p">),</span> <span class="p">);</span>
<span class="p">}</span>
<span class="k">return</span> <span class="nv">$items</span><span class="p">;</span>
<span class="p">}</span>
<span class="o">/</span><span class="err">\</span><span class="o">*</span><span class="err">\</span><span class="o">*</span><span class="err">\</span> <span class="o">*</span> <span class="nc">Implementation</span> <span class="n">of</span> <span class="n">hook_nodeapi</span><span class="err">\</span> <span class="o">*</span> <span class="o">/</span>

<span class="k">function</span> <span class="n">cambridge_mediamap_nodeapi</span><span class="p">(</span> <span class="o">&amp;</span> <span class="nv">$node</span><span class="p">,</span> <span class="nv">$op</span><span class="p">,</span> <span class="nv">$teaser</span><span class="p">,</span> <span class="nv">$page</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="nv">$op</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s1">'validate'</span><span class="o">:</span>
      <span class="k">if</span> <span class="p">(</span><span class="nf">variable_get</span><span class="p">(</span><span class="s1">'cambridge_mediamap_'</span><span class="mf">.</span><span class="nv">$node</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">type</span><span class="p">,</span> <span class="kc">TRUE</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nf">user_access</span><span class="p">(</span><span class="s1">'modify node data'</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nv">$node</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">cambridge_mediamap</span><span class="p">[</span><span class="s1">'display'</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nv">$node</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">cambridge_mediamap</span><span class="p">[</span><span class="s1">'embed'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">''</span><span class="p">)</span> <span class="p">{</span>
            <span class="nf">form_set_error</span><span class="p">(</span><span class="s1">'cambridge_mediamap'</span><span class="p">,</span> <span class="nf">t</span><span class="p">(</span><span class="s1">'Media Map: You must enter embed code or disable display of this node on the map'</span><span class="p">));</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="s1">'load'</span><span class="o">:</span>
      <span class="nv">$object</span> <span class="o">=</span> <span class="nf">db_fetch_object</span><span class="p">(</span><span class="nf">db_query</span><span class="p">(</span><span class="s1">'SELECT display, embed FROM {cambridge_mediamap} WHERE nid = %d'</span><span class="p">,</span> <span class="nv">$node</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">nid</span><span class="p">));</span>
      <span class="nv">$embed</span> <span class="o">=</span> <span class="nv">$object</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">embed</span><span class="p">;</span>
      <span class="nv">$embed_resize</span> <span class="o">=</span> <span class="nf">cambridge_mediamap_resize</span><span class="p">(</span><span class="nv">$embed</span><span class="p">);</span>
      <span class="k">return</span> <span class="k">array</span><span class="p">(</span><span class="s1">'cambridge_mediamap'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'display'</span> <span class="o">=&gt;</span> <span class="nv">$object</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">display</span><span class="p">,</span> <span class="s1">'embed'</span> <span class="o">=&gt;</span> <span class="nv">$embed</span><span class="p">,</span> <span class="s1">'embed_resize'</span> <span class="o">=&gt;</span> <span class="nv">$embed_resize</span><span class="p">,</span> <span class="p">));</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="s1">'insert'</span><span class="o">:</span>
      <span class="nf">db_query</span><span class="p">(</span><span class="s2">"INSERT INTO </span><span class="si">{</span><span class="nv">cambridge_mediamap</span><span class="si">}</span><span class="s2"> (nid, display, embed) VALUES (%d, %d, '%s')"</span><span class="p">,</span> <span class="nv">$node</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">nid</span><span class="p">,</span> <span class="nv">$node</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">cambridge_mediamap</span><span class="p">[</span><span class="s1">'display'</span><span class="p">],</span> <span class="nv">$node</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">cambridge_mediamap</span><span class="p">[</span><span class="s1">'embed'</span><span class="p">]);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="s1">'update'</span><span class="o">:</span>
      <span class="nf">db_query</span><span class="p">(</span><span class="s1">'DELETE FROM {cambridge_mediamap} WHERE nid = %d'</span><span class="p">,</span> <span class="nv">$node</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">nid</span><span class="p">);</span>
      <span class="nf">db_query</span><span class="p">(</span><span class="s2">"INSERT INTO </span><span class="si">{</span><span class="nv">cambridge_mediamap</span><span class="si">}</span><span class="s2"> (nid, display, embed) VALUES (%d, %d, '%s')"</span><span class="p">,</span> <span class="nv">$node</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">nid</span><span class="p">,</span> <span class="nv">$node</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">cambridge_mediamap</span><span class="p">[</span><span class="s1">'display'</span><span class="p">],</span> <span class="nv">$node</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">cambridge_mediamap</span><span class="p">[</span><span class="s1">'embed'</span><span class="p">]);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="s1">'delete'</span><span class="o">:</span>
      <span class="nf">db_query</span><span class="p">(</span><span class="s1">'DELETE FROM {cambridge_mediamap} WHERE nid = %d'</span><span class="p">,</span> <span class="nv">$node</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">nid</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="s1">'view'</span><span class="o">:</span>
      <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="o">/</span><span class="err">\</span><span class="o">*</span><span class="err">\</span><span class="o">*</span><span class="err">\</span> <span class="o">*</span> <span class="nc">Returns</span> <span class="n">a</span> <span class="n">resized</span> <span class="n">embed</span> <span class="n">code</span><span class="err">\</span> <span class="o">*</span> <span class="o">/</span>

<span class="k">function</span> <span class="n">cambridge_mediamap_resize</span><span class="p">(</span><span class="nv">$embed</span> <span class="o">=</span> <span class="s1">''</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$embed</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">''</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">list</span><span class="p">(</span><span class="nv">$width</span><span class="p">,</span> <span class="nv">$height</span><span class="p">)</span> <span class="o">=</span> <span class="nf">cambridge_mediamap_get_embed_size</span><span class="p">(</span><span class="nv">$embed</span><span class="p">);</span>
  <span class="c1">//width/height ratio</span>
  <span class="nv">$width_to_height</span> <span class="o">=</span> <span class="nv">$width</span> <span class="o">/</span> <span class="nv">$height</span><span class="p">;</span>
  <span class="nv">$max_width</span> <span class="o">=</span> <span class="nf">variable_get</span><span class="p">(</span><span class="s1">'cambridge_mediamap_embed_width'</span><span class="p">,</span> <span class="s1">'320'</span><span class="p">);</span>
  <span class="nv">$max_height</span> <span class="o">=</span> <span class="nf">variable_get</span><span class="p">(</span><span class="s1">'cambridge_mediamap_embed_height'</span><span class="p">,</span> <span class="s1">'240'</span><span class="p">);</span>
  <span class="c1">//shrink down widths while maintaining proportion</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$width</span> <span class="o">&gt;=</span> <span class="nv">$height</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$width</span> <span class="o">&gt;</span> <span class="nv">$max_width</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$width</span> <span class="o">=</span> <span class="nv">$max_width</span><span class="p">;</span>
      <span class="nv">$height</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="nv">$width_to_height</span><span class="p">)</span><span class="err">\</span> <span class="o">*</span> <span class="nv">$width</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$height</span> <span class="o">&gt;</span> <span class="nv">$max_height</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$height</span> <span class="o">=</span> <span class="nv">$max_height</span><span class="p">;</span>
      <span class="nv">$width</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$width_to_height</span><span class="p">)</span><span class="err">\</span> <span class="o">*</span> <span class="nv">$height</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$height</span> <span class="o">&gt;</span> <span class="nv">$max_height</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$height</span> <span class="o">=</span> <span class="nv">$max_height</span><span class="p">;</span>
      <span class="nv">$width</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$width_to_height</span><span class="p">)</span><span class="err">\</span> <span class="o">*</span> <span class="nv">$height</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$width</span> <span class="o">&gt;</span> <span class="nv">$max_width</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$width</span> <span class="o">=</span> <span class="nv">$max_width</span><span class="p">;</span>
      <span class="nv">$height</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="nv">$width_to_height</span><span class="p">)</span><span class="err">\</span> <span class="o">*</span> <span class="nv">$width</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nf">cambridge_mediamap_set_embed_size</span><span class="p">(</span><span class="nv">$embed</span><span class="p">,</span> <span class="nb">intval</span><span class="p">(</span><span class="nv">$width</span><span class="p">),</span> <span class="nb">intval</span><span class="p">(</span><span class="nv">$height</span><span class="p">));</span>
<span class="p">}</span>
<span class="o">/</span><span class="err">\</span><span class="o">*</span><span class="err">\</span><span class="o">*</span><span class="err">\</span> <span class="o">*</span> <span class="n">find</span> <span class="n">out</span> <span class="n">what</span> <span class="n">size</span> <span class="n">the</span> <span class="n">embedded</span> <span class="n">thing</span> <span class="n">is</span><span class="err">\</span> <span class="o">*</span> <span class="o">/</span>

<span class="k">function</span> <span class="n">cambridge_mediamap_get_embed_size</span><span class="p">(</span><span class="nv">$html</span><span class="p">)</span> <span class="p">{</span>
  <span class="nb">preg_match</span><span class="p">(</span><span class="s1">'/]\*width(\s\*=\s\*"|:\s\*)(\d+)/i'</span><span class="p">,</span> <span class="nv">$html</span><span class="p">,</span> <span class="nv">$match_width</span><span class="p">);</span>
  <span class="nb">preg_match</span><span class="p">(</span><span class="s1">'/]\*height(\s\*=\s\*"|:\s\*)(\d+)/i'</span><span class="p">,</span> <span class="nv">$html</span><span class="p">,</span> <span class="nv">$match_height</span><span class="p">);</span>
  <span class="k">return</span> <span class="k">array</span><span class="p">(</span><span class="nv">$match_width</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nv">$match_height</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
<span class="p">}</span>
<span class="o">/</span><span class="err">\</span><span class="o">*</span><span class="err">\</span><span class="o">*</span><span class="err">\</span> <span class="o">*</span> <span class="n">set</span> <span class="n">the</span> <span class="n">size</span> <span class="n">of</span> <span class="n">the</span> <span class="n">embeded</span> <span class="n">thing</span><span class="err">\</span> <span class="o">*</span> <span class="o">/</span>

<span class="k">function</span> <span class="n">cambridge_mediamap_set_embed_size</span><span class="p">(</span><span class="nv">$html</span><span class="p">,</span> <span class="nv">$width</span><span class="p">,</span> <span class="nv">$height</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$html</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">'/(&lt;(embed|object)\s[^&gt;]\*width(\s\*=\s\*"|:\s\*))(\d+)/i'</span><span class="p">,</span> <span class="s1">'${1}'</span><span class="mf">.</span><span class="nv">$width</span><span class="p">,</span> <span class="nv">$html</span><span class="p">);</span>
  <span class="nv">$html</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">'/(&lt;(embed|object)\s[^&gt;]\*height(\s\*=\s\*"|:\s\*))(\d+)/i'</span><span class="p">,</span> <span class="s1">'${1}'</span><span class="mf">.</span><span class="nv">$height</span><span class="p">,</span> <span class="nv">$html</span><span class="p">);</span>
  <span class="k">return</span> <span class="nv">$html</span><span class="p">;</span>
<span class="p">}</span>
<span class="o">/</span><span class="err">\</span><span class="o">*</span><span class="err">\</span><span class="o">*</span><span class="err">\</span> <span class="o">*</span> <span class="n">returns</span> <span class="n">the</span> <span class="n">base</span> <span class="n">url</span> <span class="n">of</span> <span class="n">the</span> <span class="n">src</span> <span class="n">attribute</span><span class="mf">.</span><span class="err">\</span><span class="o">*</span><span class="n">youtube</span> <span class="o">=</span> <span class="n">www</span><span class="mf">.</span><span class="n">youtube</span><span class="mf">.</span><span class="n">com</span><span class="err">\</span> <span class="o">*</span> <span class="n">blip</span> <span class="o">=</span> <span class="n">blip</span><span class="mf">.</span><span class="n">tv</span><span class="err">\</span> <span class="o">*</span> <span class="n">google</span> <span class="n">video</span> <span class="o">=</span> <span class="n">video</span><span class="mf">.</span><span class="n">google</span><span class="mf">.</span><span class="n">com</span><span class="err">\</span> <span class="o">*</span> <span class="o">/</span>

<span class="k">function</span> <span class="n">cambridge_mediamap_get_embed_source</span><span class="p">(</span><span class="nv">$html</span><span class="p">)</span> <span class="p">{</span>
  <span class="nb">preg_match</span><span class="p">(</span><span class="s1">'/]\*src="http:\/\/([^\/"]+)/i'</span><span class="p">,</span> <span class="nv">$html</span><span class="p">,</span> <span class="nv">$match_src</span><span class="p">);</span>
  <span class="k">return</span> <span class="nv">$match_src</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="p">}</span>
<span class="o">/</span><span class="err">\</span><span class="o">*</span><span class="err">\</span><span class="o">*</span><span class="err">\</span> <span class="o">*</span> <span class="nc">Implementation</span> <span class="n">of</span> <span class="n">hook_form_alter</span><span class="err">\</span> <span class="o">*</span> <span class="o">/</span>

<span class="k">function</span> <span class="n">cambridge_mediamap_form_alter</span><span class="p">(</span><span class="nv">$form_id</span><span class="p">,</span> <span class="o">&amp;</span> <span class="nv">$form</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// We're only modifying node forms, if the type field isn't set we don't need</span>
  <span class="c1">// to bother.</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">isset</span><span class="p">(</span><span class="nv">$form</span><span class="p">[</span><span class="s1">'type'</span><span class="p">]))</span> <span class="p">{</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">//disable the Gmap module's location map for unauthorized users</span>
  <span class="c1">//unfortunately Gmap.module doesn't have this setting</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$form</span><span class="p">[</span><span class="s1">'coordinates'</span><span class="p">]))</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nf">user_access</span><span class="p">(</span><span class="s1">'modify node data'</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">unset</span><span class="p">(</span><span class="nv">$form</span><span class="p">[</span><span class="s1">'coordinates'</span><span class="p">]);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="c1">// Make a copy of the type to shorten up the code</span>
  <span class="nv">$type</span> <span class="o">=</span> <span class="nv">$form</span><span class="p">[</span><span class="s1">'type'</span><span class="p">][</span><span class="s1">'#value'</span><span class="p">];</span>
  <span class="c1">// Is the map enabled for this content type?</span>
  <span class="nv">$enabled</span> <span class="o">=</span> <span class="nf">variable_get</span><span class="p">(</span><span class="s1">'cambridge_mediamap_'</span><span class="mf">.</span><span class="nv">$type</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="k">switch</span> <span class="p">(</span><span class="nv">$form_id</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// We need to have a way for administrators to indicate which content</span>
    <span class="c1">// types should have the additional media map information added.</span>
    <span class="k">case</span> <span class="nv">$type</span><span class="mf">.</span>
    <span class="s1">'_node_settings'</span><span class="o">:</span>
      <span class="nv">$form</span><span class="p">[</span><span class="s1">'workflow'</span><span class="p">][</span><span class="s1">'cambridge_mediamap_'</span><span class="mf">.</span><span class="nv">$type</span><span class="p">]</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'radios'</span><span class="p">,</span> <span class="s1">'#title'</span> <span class="o">=&gt;</span> <span class="nf">t</span><span class="p">(</span><span class="s1">'Cambridge Mediamap setting'</span><span class="p">),</span> <span class="s1">'#default_value'</span> <span class="o">=&gt;</span> <span class="nv">$enabled</span><span class="p">,</span> <span class="s1">'#options'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="mi">0</span> <span class="o">=&gt;</span> <span class="nf">t</span><span class="p">(</span><span class="s1">'Disabled'</span><span class="p">),</span> <span class="mi">1</span> <span class="o">=&gt;</span> <span class="nf">t</span><span class="p">(</span><span class="s1">'Enabled'</span><span class="p">)),</span> <span class="s1">'#description'</span> <span class="o">=&gt;</span> <span class="nf">t</span><span class="p">(</span><span class="s1">'Allow the attaching of externally hosted imbedded video to be displayed in a map?'</span><span class="p">),</span> <span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nv">$type</span><span class="mf">.</span>
    <span class="s1">'_node_form'</span><span class="o">:</span>
      <span class="k">if</span> <span class="p">(</span><span class="nv">$enabled</span> <span class="o">&amp;&amp;</span> <span class="nf">user_access</span><span class="p">(</span><span class="s1">'modify node data'</span><span class="p">))</span> <span class="p">{</span>
        <span class="c1">//create the fieldset</span>
        <span class="nv">$form</span><span class="p">[</span><span class="s1">'cambridge_mediamap'</span><span class="p">]</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'fieldset'</span><span class="p">,</span> <span class="s1">'#title'</span> <span class="o">=&gt;</span> <span class="nf">t</span><span class="p">(</span><span class="s1">'Media Map'</span><span class="p">),</span> <span class="s1">'#collapsible'</span> <span class="o">=&gt;</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="s1">'#collapsed'</span> <span class="o">=&gt;</span> <span class="kc">FALSE</span><span class="p">,</span> <span class="s1">'#tree'</span> <span class="o">=&gt;</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="p">);</span>
        <span class="c1">//insert the embed code</span>
        <span class="nv">$form</span><span class="p">[</span><span class="s1">'cambridge_mediamap'</span><span class="p">][</span><span class="s1">'embed'</span><span class="p">]</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'textarea'</span><span class="p">,</span> <span class="s1">'#title'</span> <span class="o">=&gt;</span> <span class="nf">t</span><span class="p">(</span><span class="s1">'Video Embed Code'</span><span class="p">),</span> <span class="s1">'#default_value'</span> <span class="o">=&gt;</span> <span class="nv">$form</span><span class="p">[</span><span class="s1">'#node'</span><span class="p">]</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">cambridge_mediamap</span><span class="p">[</span><span class="s1">'embed'</span><span class="p">],</span> <span class="s1">'#cols'</span> <span class="o">=&gt;</span> <span class="mi">60</span><span class="p">,</span> <span class="s1">'#rows'</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">'#description'</span> <span class="o">=&gt;</span> <span class="nf">t</span><span class="p">(</span><span class="s1">'Copy and paste the embed code from an external video or media hosting service'</span><span class="p">),</span> <span class="p">);</span>
        <span class="c1">//enable or disable on map</span>
        <span class="nv">$form</span><span class="p">[</span><span class="s1">'cambridge_mediamap'</span><span class="p">][</span><span class="s1">'display'</span><span class="p">]</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'select'</span><span class="p">,</span> <span class="s1">'#title'</span> <span class="o">=&gt;</span> <span class="nf">t</span><span class="p">(</span><span class="s1">'Display this node'</span><span class="p">),</span> <span class="s1">'#default_value'</span> <span class="o">=&gt;</span> <span class="nv">$form</span><span class="p">[</span><span class="s1">'#node'</span><span class="p">]</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">cambridge_mediamap</span><span class="p">[</span><span class="s1">'display'</span><span class="p">],</span> <span class="s1">'#options'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'0'</span> <span class="o">=&gt;</span> <span class="nf">t</span><span class="p">(</span><span class="s1">'Disable display'</span><span class="p">),</span> <span class="s1">'1'</span> <span class="o">=&gt;</span> <span class="nf">t</span><span class="p">(</span><span class="s1">'Enable display'</span><span class="p">),</span> <span class="p">),</span> <span class="p">);</span>
      <span class="p">}</span>
      <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="o">/</span><span class="err">\</span><span class="o">*</span><span class="err">\</span><span class="o">*</span><span class="err">\</span> <span class="o">*</span> <span class="nc">A</span> <span class="n">page</span> <span class="n">callback</span> <span class="n">to</span> <span class="n">draw</span> <span class="n">the</span> <span class="n">map</span><span class="err">\</span> <span class="o">*</span> <span class="o">/</span>

<span class="k">function</span> <span class="n">cambridge_mediamap_map</span><span class="p">()</span> <span class="p">{</span>
  <span class="nv">$output</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
  <span class="c1">//Collect the nodes to be displayed</span>
  <span class="nv">$results</span> <span class="o">=</span> <span class="nf">db_query</span><span class="p">(</span><span class="s1">'SELECT embed, nid FROM {cambridge_mediamap} WHERE display = 1'</span><span class="p">);</span>
  <span class="c1">//Initialize our marker array</span>
  <span class="nv">$markers</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
  <span class="c1">//check to see what modules are enabled</span>
  <span class="nv">$location_enabled</span> <span class="o">=</span> <span class="nf">module_exist</span><span class="p">(</span><span class="s1">'location'</span><span class="p">);</span>
  <span class="nv">$gmap_location_enabled</span> <span class="o">=</span> <span class="nf">module_exist</span><span class="p">(</span><span class="s1">'gmap_location'</span><span class="p">);</span>
  <span class="c1">//load each node and set it's attributes in the marker array</span>
  <span class="k">while</span> <span class="p">(</span><span class="nv">$item</span> <span class="o">=</span> <span class="nf">db_fetch_object</span><span class="p">(</span><span class="nv">$results</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$latitude</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nv">$longitude</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="c1">//load the node</span>
    <span class="nv">$node</span> <span class="o">=</span> <span class="nf">node_load</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">'nid'</span> <span class="o">=&gt;</span> <span class="nv">$item</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">nid</span><span class="p">));</span>
    <span class="c1">//set the latitude and longitude</span>
    <span class="c1">//give location module data preference over gmap module data</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$location_enabled</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$latitude</span> <span class="o">=</span> <span class="nv">$node</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">location</span><span class="p">[</span><span class="s1">'latitude'</span><span class="p">];</span>
      <span class="nv">$longitude</span> <span class="o">=</span> <span class="nv">$node</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">location</span><span class="p">[</span><span class="s1">'longitude'</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">elseif</span><span class="p">(</span><span class="nv">$gmap_location_enabled</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$latitude</span> <span class="o">=</span> <span class="nv">$node</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">gmap_location_latitude</span><span class="p">;</span>
      <span class="nv">$longitude</span> <span class="o">=</span> <span class="nv">$node</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">gmap_location_longitude</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$latitude</span> <span class="o">&amp;&amp;</span> <span class="nv">$longitude</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$markers</span><span class="p">[]</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">'label'</span> <span class="o">=&gt;</span> <span class="nf">theme</span><span class="p">(</span><span class="s1">'cambridge_mediamap_marker'</span><span class="p">,</span> <span class="nv">$node</span><span class="p">),</span> <span class="s1">'latitude'</span> <span class="o">=&gt;</span> <span class="nv">$latitude</span><span class="p">,</span> <span class="s1">'longitude'</span> <span class="o">=&gt;</span> <span class="nv">$longitude</span><span class="p">,</span> <span class="s1">'markername'</span> <span class="o">=&gt;</span> <span class="nf">variable_get</span><span class="p">(</span><span class="s1">'cambridge_mediamap_default_marker'</span><span class="p">,</span> <span class="s1">'marker'</span><span class="p">),</span> <span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="nv">$latlon</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s1">','</span><span class="p">,</span> <span class="nf">variable_get</span><span class="p">(</span><span class="s1">'cambridge_mediamap_default_latlong'</span><span class="p">,</span> <span class="s1">'42.369452,-71.100426'</span><span class="p">));</span>
  <span class="nv">$map</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">'id'</span> <span class="o">=&gt;</span> <span class="s1">'cambridge_mediamap'</span><span class="p">,</span> <span class="s1">'latitude'</span> <span class="o">=&gt;</span> <span class="nb">trim</span><span class="p">(</span><span class="nv">$latlon</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="s1">'longitude'</span> <span class="o">=&gt;</span> <span class="nb">trim</span><span class="p">(</span><span class="nv">$latlon</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="s1">'width'</span> <span class="o">=&gt;</span> <span class="nf">variable_get</span><span class="p">(</span><span class="s1">'cambridge_mediamap_default_width'</span><span class="p">,</span> <span class="s1">'100%'</span><span class="p">),</span> <span class="s1">'height'</span> <span class="o">=&gt;</span> <span class="nf">variable_get</span><span class="p">(</span><span class="s1">'cambridge_mediamap_default_height'</span><span class="p">,</span> <span class="s1">'500px'</span><span class="p">),</span> <span class="s1">'zoom'</span> <span class="o">=&gt;</span> <span class="nf">variable_get</span><span class="p">(</span><span class="s1">'cambridge_mediamap_default_zoom'</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span> <span class="s1">'control'</span> <span class="o">=&gt;</span> <span class="nf">variable_get</span><span class="p">(</span><span class="s1">'cambridge_mediamap_default_control'</span><span class="p">,</span> <span class="s1">'Large'</span><span class="p">),</span> <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="nf">variable_get</span><span class="p">(</span><span class="s1">'cambridge_mediamap_default_type'</span><span class="p">,</span> <span class="s1">'Satellite'</span><span class="p">),</span> <span class="s1">'markers'</span> <span class="o">=&gt;</span> <span class="nv">$markers</span><span class="p">,</span> <span class="p">);</span>
  <span class="k">return</span> <span class="nf">gmap_draw_map</span><span class="p">(</span><span class="nv">$map</span><span class="p">);</span>
<span class="p">}</span>
<span class="o">/</span><span class="err">\</span><span class="o">*</span><span class="err">\</span><span class="o">*</span><span class="err">\</span> <span class="o">*</span> <span class="nc">A</span> <span class="n">theme</span>
<span class="k">function</span>
<span class="n">for</span> <span class="n">our</span> <span class="n">markers</span><span class="err">\</span> <span class="o">*</span> <span class="o">/</span>

<span class="k">function</span> <span class="n">theme_cambridge_mediamap_marker</span><span class="p">(</span><span class="nv">$node</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$output</span> <span class="o">=</span> <span class="s1">'
  '</span><span class="p">;</span>
  <span class="nv">$output</span><span class="mf">.</span> <span class="o">=</span> <span class="s1">'
  '</span> <span class="mf">.</span> <span class="nf">l</span><span class="p">(</span><span class="nv">$node</span><span class="o">-&gt;</span><span class="n">title</span><span class="p">,</span> <span class="s1">'
  node / '</span> <span class="mf">.</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="n">nid</span><span class="p">)</span> <span class="mf">.</span> <span class="s1">'
  '</span><span class="p">;</span>
  <span class="nv">$output</span><span class="mf">.</span> <span class="o">=</span> <span class="s1">'
  '</span> <span class="mf">.</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="n">cambridge_mediamap</span><span class="p">[</span><span class="s1">'
  embed_resize '</span><span class="p">]</span> <span class="mf">.</span> <span class="s1">'
  '</span><span class="p">;</span>
  <span class="nv">$output</span><span class="mf">.</span> <span class="o">=</span> <span class="s1">'
  '</span><span class="p">;</span>
  <span class="k">return</span> <span class="nv">$output</span><span class="p">;</span>
<span class="p">}</span>
<span class="o">/</span><span class="err">\</span><span class="o">*</span><span class="err">\</span><span class="o">*</span><span class="err">\</span> <span class="o">*</span> <span class="nc">Settings</span> <span class="n">page</span><span class="err">\</span> <span class="o">*</span> <span class="o">/</span>

<span class="k">function</span> <span class="n">cambridge_mediamap_settings</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Cambridge data</span>
  <span class="c1">// latitude = 42.369452</span>
  <span class="c1">// longitude = -71.100426</span>
  <span class="nv">$form</span><span class="p">[</span><span class="s1">'defaults'</span><span class="p">]</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'fieldset'</span><span class="p">,</span> <span class="s1">'#title'</span> <span class="o">=&gt;</span> <span class="nf">t</span><span class="p">(</span><span class="s1">'Default map settings'</span><span class="p">),</span> <span class="p">);</span>
  <span class="nv">$form</span><span class="p">[</span><span class="s1">'defaults'</span><span class="p">][</span><span class="s1">'cambridge_mediamap_default_width'</span><span class="p">]</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'textfield'</span><span class="p">,</span> <span class="s1">'#title'</span> <span class="o">=&gt;</span> <span class="nf">t</span><span class="p">(</span><span class="s1">'Default width'</span><span class="p">),</span> <span class="s1">'#default_value'</span> <span class="o">=&gt;</span> <span class="nf">variable_get</span><span class="p">(</span><span class="s1">'cambridge_mediamap_default_width'</span><span class="p">,</span> <span class="s1">'100%'</span><span class="p">),</span> <span class="s1">'#size'</span> <span class="o">=&gt;</span> <span class="mi">25</span><span class="p">,</span> <span class="s1">'#maxlength'</span> <span class="o">=&gt;</span> <span class="mi">6</span><span class="p">,</span> <span class="s1">'#description'</span> <span class="o">=&gt;</span> <span class="nf">t</span><span class="p">(</span><span class="s1">'The default width of a Google map. Either px or %'</span><span class="p">),</span> <span class="p">);</span>
  <span class="nv">$form</span><span class="p">[</span><span class="s1">'defaults'</span><span class="p">][</span><span class="s1">'cambridge_mediamap_default_height'</span><span class="p">]</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'textfield'</span><span class="p">,</span> <span class="s1">'#title'</span> <span class="o">=&gt;</span> <span class="nf">t</span><span class="p">(</span><span class="s1">'Default height'</span><span class="p">),</span> <span class="s1">'#default_value'</span> <span class="o">=&gt;</span> <span class="nf">variable_get</span><span class="p">(</span><span class="s1">'cambridge_mediamap_default_height'</span><span class="p">,</span> <span class="s1">'500px'</span><span class="p">),</span> <span class="s1">'#size'</span> <span class="o">=&gt;</span> <span class="mi">25</span><span class="p">,</span> <span class="s1">'#maxlength'</span> <span class="o">=&gt;</span> <span class="mi">6</span><span class="p">,</span> <span class="s1">'#description'</span> <span class="o">=&gt;</span> <span class="nf">t</span><span class="p">(</span><span class="s1">'The default height of Mediamap. In px.'</span><span class="p">),</span> <span class="p">);</span>
  <span class="nv">$form</span><span class="p">[</span><span class="s1">'defaults'</span><span class="p">][</span><span class="s1">'cambridge_mediamap_default_latlong'</span><span class="p">]</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'textfield'</span><span class="p">,</span> <span class="s1">'#title'</span> <span class="o">=&gt;</span> <span class="nf">t</span><span class="p">(</span><span class="s1">'Default center'</span><span class="p">),</span> <span class="s1">'#default_value'</span> <span class="o">=&gt;</span> <span class="nf">variable_get</span><span class="p">(</span><span class="s1">'cambridge_mediamap_default_latlong'</span><span class="p">,</span> <span class="s1">'42.369452,-71.100426'</span><span class="p">),</span> <span class="s1">'#description'</span> <span class="o">=&gt;</span> <span class="s1">'The decimal latitude,longitude of the centre of the map. The "." is used for decimal, and "," is used to separate latitude and longitude.'</span><span class="p">,</span> <span class="s1">'#size'</span> <span class="o">=&gt;</span> <span class="mi">50</span><span class="p">,</span> <span class="s1">'#maxlength'</span> <span class="o">=&gt;</span> <span class="mi">255</span><span class="p">,</span> <span class="s1">'#description'</span> <span class="o">=&gt;</span> <span class="nf">t</span><span class="p">(</span><span class="s1">'The default longitude, latitude of Mediamap.'</span><span class="p">),</span> <span class="p">);</span>
  <span class="nv">$form</span><span class="p">[</span><span class="s1">'defaults'</span><span class="p">][</span><span class="s1">'cambridge_mediamap_default_zoom'</span><span class="p">]</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'select'</span><span class="p">,</span> <span class="s1">'#title'</span> <span class="o">=&gt;</span> <span class="nf">t</span><span class="p">(</span><span class="s1">'Default zoom'</span><span class="p">),</span> <span class="s1">'#default_value'</span> <span class="o">=&gt;</span> <span class="nf">variable_get</span><span class="p">(</span><span class="s1">'cambridge_mediamap_default_zoom'</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span> <span class="s1">'#options'</span> <span class="o">=&gt;</span> <span class="nf">drupal_map_assoc</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">17</span><span class="p">)),</span> <span class="s1">'#description'</span> <span class="o">=&gt;</span> <span class="nf">t</span><span class="p">(</span><span class="s1">'The default zoom level of Mediamap.'</span><span class="p">),</span> <span class="p">);</span>
  <span class="nv">$form</span><span class="p">[</span><span class="s1">'defaults'</span><span class="p">][</span><span class="s1">'cambridge_mediamap_default_control'</span><span class="p">]</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'select'</span><span class="p">,</span> <span class="s1">'#title'</span> <span class="o">=&gt;</span> <span class="nf">t</span><span class="p">(</span><span class="s1">'Default control type'</span><span class="p">),</span> <span class="s1">'#default_value'</span> <span class="o">=&gt;</span> <span class="nf">variable_get</span><span class="p">(</span><span class="s1">'cambridge_mediamap_default_control'</span><span class="p">,</span> <span class="s1">'Large'</span><span class="p">),</span> <span class="s1">'#options'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'None'</span> <span class="o">=&gt;</span> <span class="nf">t</span><span class="p">(</span><span class="s1">'None'</span><span class="p">),</span> <span class="s1">'Small'</span> <span class="o">=&gt;</span> <span class="nf">t</span><span class="p">(</span><span class="s1">'Small'</span><span class="p">),</span> <span class="s1">'Large'</span> <span class="o">=&gt;</span> <span class="nf">t</span><span class="p">(</span><span class="s1">'Large'</span><span class="p">)),</span> <span class="p">);</span>
  <span class="nv">$form</span><span class="p">[</span><span class="s1">'defaults'</span><span class="p">][</span><span class="s1">'cambridge_mediamap_default_type'</span><span class="p">]</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'select'</span><span class="p">,</span> <span class="s1">'#title'</span> <span class="o">=&gt;</span> <span class="nf">t</span><span class="p">(</span><span class="s1">'Default map type'</span><span class="p">),</span> <span class="s1">'#default_value'</span> <span class="o">=&gt;</span> <span class="nf">variable_get</span><span class="p">(</span><span class="s1">'cambridge_mediamap_default_type'</span><span class="p">,</span> <span class="s1">'Satellite'</span><span class="p">),</span> <span class="s1">'#options'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'Map'</span> <span class="o">=&gt;</span> <span class="nf">t</span><span class="p">(</span><span class="s1">'Map'</span><span class="p">),</span> <span class="s1">'Satellite'</span> <span class="o">=&gt;</span> <span class="nf">t</span><span class="p">(</span><span class="s1">'Satellite'</span><span class="p">),</span> <span class="s1">'Hybrid'</span> <span class="o">=&gt;</span> <span class="nf">t</span><span class="p">(</span><span class="s1">'Hybrid'</span><span class="p">)),</span> <span class="p">);</span>
  <span class="nv">$markers</span> <span class="o">=</span> <span class="nf">gmap_get_markers</span><span class="p">();</span>
  <span class="nv">$form</span><span class="p">[</span><span class="s1">'defaults'</span><span class="p">][</span><span class="s1">'cambridge_mediamap_default_marker'</span><span class="p">]</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'select'</span><span class="p">,</span> <span class="s1">'#title'</span> <span class="o">=&gt;</span> <span class="nf">t</span><span class="p">(</span><span class="s1">'Marker'</span><span class="p">),</span> <span class="s1">'#default_value'</span> <span class="o">=&gt;</span> <span class="nf">variable_get</span><span class="p">(</span><span class="s1">'cambridge_mediamap_default_marker'</span><span class="p">,</span> <span class="s1">'marker'</span><span class="p">),</span> <span class="s1">'#options'</span> <span class="o">=&gt;</span> <span class="nv">$markers</span><span class="p">,</span> <span class="p">);</span>
  <span class="nv">$form</span><span class="p">[</span><span class="s1">'embed'</span><span class="p">]</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'fieldset'</span><span class="p">,</span> <span class="s1">'#title'</span> <span class="o">=&gt;</span> <span class="nf">t</span><span class="p">(</span><span class="s1">'Default embedded video settings'</span><span class="p">),</span> <span class="p">);</span>
  <span class="nv">$form</span><span class="p">[</span><span class="s1">'embed'</span><span class="p">][</span><span class="s1">'cambridge_mediamap_embed_width'</span><span class="p">]</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'textfield'</span><span class="p">,</span> <span class="s1">'#title'</span> <span class="o">=&gt;</span> <span class="nf">t</span><span class="p">(</span><span class="s1">'Default width'</span><span class="p">),</span> <span class="s1">'#default_value'</span> <span class="o">=&gt;</span> <span class="nf">variable_get</span><span class="p">(</span><span class="s1">'cambridge_mediamap_embed_width'</span><span class="p">,</span> <span class="s1">'320'</span><span class="p">),</span> <span class="s1">'#size'</span> <span class="o">=&gt;</span> <span class="mi">25</span><span class="p">,</span> <span class="s1">'#maxlength'</span> <span class="o">=&gt;</span> <span class="mi">6</span><span class="p">,</span> <span class="s1">'#description'</span> <span class="o">=&gt;</span> <span class="nf">t</span><span class="p">(</span><span class="s1">'The maximum width of embedded video'</span><span class="p">),</span> <span class="p">);</span>
  <span class="nv">$form</span><span class="p">[</span><span class="s1">'embed'</span><span class="p">][</span><span class="s1">'cambridge_mediamap_embed_height'</span><span class="p">]</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'textfield'</span><span class="p">,</span> <span class="s1">'#title'</span> <span class="o">=&gt;</span> <span class="nf">t</span><span class="p">(</span><span class="s1">'Default height'</span><span class="p">),</span> <span class="s1">'#default_value'</span> <span class="o">=&gt;</span> <span class="nf">variable_get</span><span class="p">(</span><span class="s1">'cambridge_mediamap_embed_height'</span><span class="p">,</span> <span class="s1">'240'</span><span class="p">),</span> <span class="s1">'#size'</span> <span class="o">=&gt;</span> <span class="mi">25</span><span class="p">,</span> <span class="s1">'#maxlength'</span> <span class="o">=&gt;</span> <span class="mi">6</span><span class="p">,</span> <span class="s1">'#description'</span> <span class="o">=&gt;</span> <span class="nf">t</span><span class="p">(</span><span class="s1">'The maximum height of embedded video.'</span><span class="p">),</span> <span class="p">);</span>
  <span class="k">return</span> <span class="nv">$form</span><span class="p">;</span>
<span class="p">}</span>
<span class="o">/</span><span class="err">\</span><span class="o">*</span><span class="err">\</span><span class="o">*</span><span class="err">\</span> <span class="o">*</span> <span class="nc">Prints</span> <span class="n">human</span> <span class="o">-</span> <span class="nf">readable</span><span class="p">(</span><span class="n">html</span><span class="p">)</span> <span class="n">information</span> <span class="n">about</span> <span class="n">a</span> <span class="n">variable</span><span class="mf">.</span><span class="err">\</span><span class="o">*</span><span class="kn">Use</span><span class="o">:</span> <span class="k">print</span> <span class="nf">debug</span><span class="p">(</span><span class="nv">$variable_name</span><span class="p">);</span><span class="err">\</span> <span class="o">*</span> <span class="k">Or</span> <span class="n">assign</span> <span class="n">output</span> <span class="n">to</span> <span class="n">a</span> <span class="n">variable</span><span class="mf">.</span><span class="err">\</span><span class="o">*/</span>

<span class="k">function</span> <span class="n">debug</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s2">"/\s/"</span><span class="p">,</span> <span class="s2">" "</span><span class="p">,</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s2">"/</span><span class="se">\n</span><span class="s2">/"</span><span class="p">,</span> <span class="s2">""</span><span class="p">,</span> <span class="nb">print_r</span><span class="p">(</span><span class="nv">$value</span><span class="p">,</span> <span class="kc">true</span><span class="p">)));</span>
<span class="p">}</span>
</code></pre></div></div>

  </div>
</article>


    <hr>
  
    

<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">
      <a class="post-link" href="/2007/08/Walkabout-Trail-RI.html">Walkabout Trail, RI</a>
    </h1>
    <p class="post-meta text-muted">
      <time datetime="2007-08-01T00:00:00+00:00" itemprop="datePublished">August 1, 2007</time>
      
      


  

  

  • Tagged <a href="/tags/#friends">friends</a>, <a href="/tags/#frogs">frogs</a>, <a href="/tags/#hiking">hiking</a>, and <a href="/tags/#mossy">mossy</a>


    </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p><a href="http://www.flickr.com/photos/bensheldon/819325062/" title="Photo Sharing"> <img src="http://farm2.static.flickr.com/1327/819325062_64e6660ffa_m.jpg" alt="Frog" /> </a> <a href="http://www.flickr.com/photos/bensheldon/818413293/" title="Photo Sharing"> <img src="http://farm2.static.flickr.com/1054/818413293_f3c656f1ce_m.jpg" alt="Helen sees something" /> </a></p>

<p>A few weeks ago I hiked the <a href="http://www.google.com/maps?q=Providence,+RI,+USA&amp;ie=UTF8&amp;ll=41.92353,-71.75776&amp;spn=0.00372,0.009388&amp;t=h&amp;z=17&amp;om=1">Walkabout Trail</a> in Northwestern Rhode Island with my friend <a href="http://flickr.com/photos/helenday/">Helen</a>. The trail was gorgeously green and mossy with many fun frogs, toads and critters. We hiked the eight miles (which cuts for shorter walks) in a little over three hours, which was a great pace leading up to a cooling swim in the adjoining pond afterwards.</p>

<p><a href="http://flickr.com/photos/bensheldon/sets/72157600835146342/"> <img src="/uploads/2007-08/walkabout-trail.png" alt="" /> </a></p>

  </div>
</article>


    <hr>
  
    

<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">
      <a class="post-link" href="/2007/07/Should-I-get-a-nonprofit-job.html">"Should I get a nonprofit job?"</a>
    </h1>
    <p class="post-meta text-muted">
      <time datetime="2007-07-19T00:00:00+00:00" itemprop="datePublished">July 19, 2007</time>
      
      


  

  

  • Tagged <a href="/tags/#advice">advice</a>, <a href="/tags/#career">career</a>, <a href="/tags/#nonprofit">nonprofit</a>, and <a href="/tags/#strategy">strategy</a>


    </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>I have a lot of friends and acquaintances considering a job in the nonprofit sector. I’ve been employed within small (under $2 million budgets), community nonprofit organizations for three years now, beginning straight out of college, but have also talked to many people with many different experiences and histories in the sector and outside of it about their experiences. The following is my boilerplate advice to people that asks me about working, or finding work, within nonprofits.</p>

<p>Assuming that you are an intelligent, well-educated (or seeking to be), self-motivated and upwardly mobile individual, your interest probably spans a combination of two distinct (or should be in your mind) issues:</p>

<ul>
  <li>You want a job, with a modicum of stability, freedom, and disposable income.</li>
  <li>You want to change the world, or a least do it less harm than otherwise.</li>
</ul>

<p><strong>My advice for you:</strong></p>

<blockquote>
  <p>Find a corporate job that you like, or don’t feel too guilty about, and that provides you with plenty of disposable income and time. Find a small, local nonprofit (or church, or social group) that meets your standards for doing good, and invest your disposable income and time with them. Join their governing board, connect them with your professional and personal networks and help them grow in a direction you believe in. You will enact more change from a higher level than you could, in most situations, by being a direct employee of that organization.</p>
</blockquote>

<p><strong>Non-categorical rationale:</strong></p>

<p>Nonprofits have jobs, but they don’t have a lot of them and it’s hard to break into one that distinguishes you from your peers: you can find a job answering phones, but it’s difficult to get one with responsibility and authority. Nonprofits are bad (or relatively worse than their commercial peers) at: recognizing ability, enabling it, and rewarding it.</p>

<p>Nonprofits are insulating. Because you are constantly understaffed, under-budgeted and under-resourced (time, training, equipment) it is difficult to find the time to truly reflect. It is difficult to critically look at what you are doing and what you have done; to connect with other practitioners and look at what you are doing as a group; to reach outside the sector to learn from others and see how you fit into that broadest context.</p>

<p>A job is a job, wherever you’re working. This may sound selfish (and it probably is) but you should be concerned that, whatever your job is, you:</p>

<ol>
  <li>are challenged</li>
  <li>are encouraged to try and learn new things</li>
  <li>are acknowledged (even celebrated on occassion)</li>
  <li>can advance to greater responsibility and authority</li>
  <li>are provided a separate personal life</li>
  <li>are afforded physical and mental health (no 80 hour weeks or screaming matches)</li>
  <li>have fun or enjoy your work a majority of the time (no puritan work ethic for me)</li>
</ol>

<p>By looking after yourself on an individual level, you will ultimately be in a better position to have compassion for those around you and be better positioned to act upon that compassion.</p>

  </div>
</article>


    <hr>
  
    

<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">
      <a class="post-link" href="/2007/07/Planning-Strategic-Planning.html">Planning Strategic Planning</a>
    </h1>
    <p class="post-meta text-muted">
      <time datetime="2007-07-15T00:00:00+00:00" itemprop="datePublished">July 15, 2007</time>
      
      


  

  

  • Tagged <a href="/tags/#advice">advice</a>, <a href="/tags/#nonprofit">nonprofit</a>, and <a href="/tags/#strategic_planning">strategic planning</a>


    </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>At work I have been furiously engaged in strategic planning in advance of some major grant-writing. This process is a continuation from some vine-withered efforts my coworker and I had made last fall, but due to some changing circumstances—a better understanding of the existing processes at play and increased authority to manage the outcomes—this most recent effort is bearing more fruit.</p>

<p>Perhaps the largest set-back to our strategic planning projects has been <em>the planning of our strategic planning</em>. Without having to recurse infinitely backwards, perhaps the most important things I’ve learned are:</p>

<ul>
  <li>
    <p><strong>Strategic planning relies on individuals.</strong> Strategic planning usually requires the actions of a single, or a small handful of individuals that not only are motivated, but have the resources and authority (or the full backing of someone with authority) to proceed. This is not to diminish the value of <a href="http://en.wikipedia.org/wiki/Swot_analysis">SWOT</a> or <a href="http://en.wikipedia.org/wiki/SMART_(project_management)">SMART</a>, but to reaffirm that strategic planning relies upon someone to begin the process, facilitate it, and ensure that its outcomes are useful.</p>
  </li>
  <li>
    <p><strong>Strategic planning should build on your strengths.</strong> There is a tendency to relegate strategic planning activities to weak periods or to use it to shore up areas that are perceived lacking. This often means that you aren’t able to properly recognize what led to successful periods or why certain components succeeded.</p>
  </li>
  <li>
    <p><strong>Define goals by need, not by resources or activities.</strong> Perhaps due to the tendency to use strategic planning to shore up weaknesses, goals are often defined narrowly out of current activities. Rather, goals should be widest effect you hope to enact. Just because a program’s goals are narrow does not mean that an organization cannot hope to affect a broader mission; or that a program cannot target only a single need within a much larger issue.</p>
  </li>
</ul>

<p>These three pieces come from my own experience with strategic planning, but I do like that they tie in nicely with much broader advice on philanthropy from Peter Drucker (via <a href="http://giving.typepad.com/theworldwewant/2006/05/update_on_the_w.html">The World We Want</a>):</p>

<ol>
  <li>
    <p>Fund extraordinary people, not institutions.</p>
  </li>
  <li>
    <p>Build on islands of health, not problems to be solved.</p>
  </li>
  <li>
    <p>Get big or get gone. Scale up to the size of the need, not down to the resources available.</p>
  </li>
</ol>

<p>(I’m always looking this quote up for a variety of reasons, so for simplicities sake I figure I should just post it here.)</p>

  </div>
</article>


    <hr>
  
    

<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">
      <a class="post-link" href="/2007/06/Small-things-of-Spring.html">Small things of Spring</a>
    </h1>
    <p class="post-meta text-muted">
      <time datetime="2007-06-04T00:00:00+00:00" itemprop="datePublished">June 4, 2007</time>
      
      


  

  

  • Tagged <a href="/tags/#bugs">bugs</a>, <a href="/tags/#geese">geese</a>, <a href="/tags/#photos">photos</a>, <a href="/tags/#small_things">small things</a>, and <a href="/tags/#spring">spring</a>


    </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p><a href="http://www.flickr.com/photos/bensheldon/530395402/" title="Photo Sharing"> <img src="http://farm2.static.flickr.com/1285/530395402_2567dc64cd.jpg" alt="Goslings" /> </a></p>

<p><a href="http://www.flickr.com/photos/bensheldon/530535995/" title="Photo Sharing"> <img src="http://farm2.static.flickr.com/1220/530535995_82b282cda5.jpg" alt="Ladybug in the Garden" /> </a></p>

<p><a href="http://www.flickr.com/photos/bensheldon/513475262/" title="Photo Sharing"> <img src="http://farm1.static.flickr.com/207/513475262_e9fb4f340d.jpg" alt="Early Grapes" /> </a></p>


  </div>
</article>


    <hr>
  
    

<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">
      <a class="post-link" href="/2007/05/Spring-arrives.html">Spring arrives</a>
    </h1>
    <p class="post-meta text-muted">
      <time datetime="2007-05-09T00:00:00+00:00" itemprop="datePublished">May 9, 2007</time>
      
      


  

  

  • Tagged <a href="/tags/#Boston">Boston</a>, <a href="/tags/#flowers">flowers</a>, <a href="/tags/#season">season</a>, <a href="/tags/#spring">spring</a>, and <a href="/tags/#Washington_DC">Washington DC</a>


    </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p><a href="http://www.flickr.com/photos/bensheldon/448506773/" title="Photo Sharing"> <img src="http://farm1.static.flickr.com/218/448506773_55049ea73c.jpg" alt="CIMG2509.JPG" /> </a></p>

<p>Spring came a lot earlier to Washington, DC than it did to New England, but the mercury is topping 80 today in Boston. Above, I’m at the Cherry Blossom Festival in Washington, DC last month. Below is the one of the multitudinous dandelions that have sprung up around UMass Boston.</p>

<p><a href="http://www.flickr.com/photos/bensheldon/489864761/" title="Photo Sharing"> <img src="http://farm1.static.flickr.com/194/489864761_ffcbfa0a22.jpg" alt="Dandelions at UMass Boston" /> </a></p>

  </div>
</article>


    <hr>
  
    

<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">
      <a class="post-link" href="/2007/04/New-England-Construction.html">New England Construction</a>
    </h1>
    <p class="post-meta text-muted">
      <time datetime="2007-04-29T00:00:00+00:00" itemprop="datePublished">April 29, 2007</time>
      
      


  

  

  • Tagged <a href="/tags/#architecture">architecture</a>, <a href="/tags/#detective_story">detective story</a>, and <a href="/tags/#fiction">fiction</a>


    </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p><em>Wrote this a while back and it’s been floating around my drafts pile. The story is a little light, but mostly I wrote it to remember all the arcane details my landlord’s handyman told me when he came to rehang our doors.</em></p>

<p>Monday morning; my girl was out of town on business. Her business. I was watching the Price is Right: dolts with nothing better to do with their time either. One knocked at my door.</p>

<p>I wiped the spent food refuse and old files towards the far end of my desk. The desk is a large one and sometimes that’s needed. Today it wasn’t.</p>

<p>I called it, her, in.</p>

<p>I’m no bunny humper but fur coats make little sense to me I don’t need the socio-economic, market differentiation explanation. Here’s an old woman, probably afraid to watch the evening news, yet wears the clothing equivalent of a sausage factory.</p>

<p>I operate my business on a sliding scale. I slid it to the right. I’ve been known to do pro-bono, but I didn’t think she’d need it. She didn’t.</p>

<p>“I’ve lost something.”</p>

<p>I keep my list of services vague. Boston’s a tough town and you never know when a treed cat will pay the heating bill.</p>

<p>“A ring, it’s somewhere in my house.”</p>

<p>“I’m sorry, Miss—”</p>

<p>“Capshaw, Rosemary Capshaw.”</p>

<p>“I don’t do house cleaning. Perhaps you have an assistant?” Or a psychic. But from the looks of her she probably did; on retainer. A phrenologist too. I gave the scale another shove.</p>

<p>“No, it’s in my house. Somewhere in the walls.”</p>

<p>“You need a carpenter.” And a shrink. But she’d already have one of those too; maybe should up her dose.</p>

<p>“I had one but he couldn’t find it. He tore my house apart and still couldn’t find it. Then he gave me your number.”</p>

<p>I have to wonder about the people that recommend me. I probably photographed his wife cheating. Maybe roughed the guy up too. Value-addeds make customers for life.</p>

<p>“I’ll see what I can do.” My calendar, if I had a calendar, was empty; also why I don’t have a calendar.</p>

<p>Rosemary drove. I could have asked to bring along an elephant and it would have fit comfortably in the backseat; might have scuffed up the leather though.</p>

<p>Her house was large, but that was to be expected considering she needed somewhere to park the car. It was an old carriage house with a mansard roof. That sort of thing may have fooled the French, who taxed by the floor, but Yankee assayers are more clever. They call it historical architecture and increase the value. But I don’t think property taxes keep Rosemary up at night.</p>

<p>She had a nice place. Selling it would lead to quite the nice South Florida retirement. Nothing like my own apartment. Atlantic city has nothing on the Boston rental market: the odds are horrible and the house always wins. I rent the second floor of a triple-decker. Unless I experience a “life altering” event, I’m guaranteed to be out on my ass: carting my belongings down the street when the place goes condo, or in an ambulance when the owner firebombs it.</p>

<p>She showed me to the attic. Quite a carpenter she found; the place was ripped to shreds. To be expected if the guy recommended me. The floorboards along an entire wall was torn apart, down to the studs.</p>

<p>While we were driving over she explained the situation: priceless ring, slip of the hand, crack in the floor.</p>

<p>“So you’re sure this is exactly where it slipped.”</p>

<p>“Completely. I was right here.”</p>

<p>“What’s beneath this?”</p>

<p>“My parlor.”</p>

<p>The wood in this place was amazing, and I don’t just mean the floor. Moldings, doorframes, inset cabinetry was all perfect. Most times it’s easier just gut them rather than refinish. Replace priceless mahogany and cherry with spruce or pine. Spruce takes a good coat of paint but not much else. As for pine, when I was a baby I teethed on our furniture. Wouldn’t happen here though. Somebody probably sanded their family a new car working on this place and that car would still be out of my price range.</p>

<p>In the parlor the baseboards were completely torn up too, with obvious belief that the ring would have fallen down through the wall. No insulation: typical. Coldest winters in the country and nobody thinks to use a little fiberglass.</p>

<p>I knocked the wall. Carpenter was a dolt. New England houses are always interesting, and he apparently didn’t know this one’s particular peculiarity:</p>

<p>Hurricane brace; a solid beam running diagonally across the wall. From modern architectural standing such a thing is half over-engineering, half-diminished standards: buildings these days are mostly plastic wrap. That it comes from 3M rather than Stretch-Tite doesn’t make much of a difference.</p>

<p>I measured out the dimensions in my head, matching up where she dropped her ring in the attic above.</p>

<p>“Do you mind?”</p>

<p>Plaster walls: it takes a jackhammer to drive a nail into, but any flat, blunt object will bust them wide open. Like a fist.</p>

<p>There are few parts of my CV I enjoy more than my extensive knowledge of and experience in effectively hitting things. The wall gave way in a burst of gypsum and lead paint. Between the mangled wooden strips of plaster-backing, I spotted a glint of something.</p>

<p>I reached through the hole, gave my sliding scale one last tap, and retrieved her ring. Needless to say, she was satisfied. And cleaning up is never a part of my job description.</p>

  </div>
</article>


    <hr>
  
    

<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">
      <a class="post-link" href="/2007/04/Introducing-Panlexiconcom.html">Introducing Panlexicon.com</a>
    </h1>
    <p class="post-meta text-muted">
      <time datetime="2007-04-14T00:00:00+00:00" itemprop="datePublished">April 14, 2007</time>
      
      


  

  

  • Tagged <a href="/tags/#development">development</a>, <a href="/tags/#launch">launch</a>, <a href="/tags/#navigation">navigation</a>, <a href="/tags/#portfolio">portfolio</a>, <a href="/tags/#synonyms">synonyms</a>, <a href="/tags/#thesaurus">thesaurus</a>, <a href="/tags/#webdesign">webdesign</a>, and <a href="/tags/#website">website</a>


    </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p><a href="http://www.flickr.com/photos/bensheldon/459184378/" title="Photo Sharing"> <img src="http://farm1.static.flickr.com/178/459184378_b3538d860c.jpg" alt="Panlexicon.com" /> </a></p>

<p>I’m very proud to be officially launching ** <a href="http://panlexicon.com">Panlexicon.com</a>: a unique thesaurus<strong>. Using intuitive **“tag clouds”</strong> to represent synonyms, <a href="http://panlexicon.com">Panlexicon</a> makes discovering the word you want quick, easy and explorational.</p>

<p>Panlexicon’s current functions allow you to:</p>

<ul>
  <li>
    <p><strong>First</strong>, perform a lookup on a single word and receive a weighted cloud of synonyms.</p>
  </li>
  <li>
    <p><strong>Second</strong>, view synonyms that overlap across multiple words either by entering the words manually, or clicking on words already in the cloud to further refine your search.</p>
  </li>
</ul>

<p><strong>For example</strong>, performing a search on “ <a href="http://panlexicon.com/?query=cool">cool</a>” provides a wide variety of synonyms from “chilly”, to “unimpassioned”, to “groovy”. Refining the search using <a href="http://panlexicon.com/?query=cool,nifty">cool <em>and</em> nifty</a> provides more refined synonyms.</p>

<p>By varying the size of the typeface, like tag clouds do, the most relevant terms <strong>pop out at you</strong> allowing you to quickly scan through large lists of words. Also, because the algorithm is a little fuzzy, you may run across related words that provide better context.</p>

<p>Panlexicon was developed jointly with <a href="http://circuitous.org">Rebecca</a> who originally proposed the project and did much of the research on thesauri and helped develop the word relevance algorithms.</p>

<p>The word lists come from the <a href="http://www.gutenberg.org/etext/3202">Moby Thesaurus</a> as part of <a href="http://www.gutenberg.org/">Project Gutenburg’s</a> library of free electronic texts. <a href="http://drupal.org">Drupal</a> is used as a simple framework for core functions such as database abstraction and page callbacks and to simplify future feature developments. Google AdSense is activated on the site, but that is due more to curiosity over the interplay of contextual advertising and the word lists than on any current revenue model.</p>

  </div>
</article>


    <hr>
  
    

<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">
      <a class="post-link" href="/2007/04/Nonprofit-Communications-20.html">Nonprofit Communications 2.0</a>
    </h1>
    <p class="post-meta text-muted">
      <time datetime="2007-04-13T00:00:00+00:00" itemprop="datePublished">April 13, 2007</time>
      
      


  

  

  • Tagged <a href="/tags/#07ntc">07ntc</a>, <a href="/tags/#communications">communications</a>, <a href="/tags/#conference">conference</a>, <a href="/tags/#nonprofit">nonprofit</a>, <a href="/tags/#nptech">nptech</a>, <a href="/tags/#nten">nten</a>, <a href="/tags/#strategy">strategy</a>, and <a href="/tags/#video">video</a>


    </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>Last week I attended NTEN’s 2007 <a href="http://nten.org/ntc">Nonprofit Technology Conference</a> and sat in on a wonderful session entitled <strong>Nonprofit Communications 2.0: Seven Steps to Transform Your Organization.</strong> Led by <a href="http://www.cctv.org/index.php?SiteAlias=cctv&amp;PageAlias=CCTV_Staff#LG">Lauren-Glenn Davitian</a> of the <a href="http://www.cctv.org/">CCTV Center for Media and Democracy</a>, the session provided a strong framework for nonprofits to better communicate in an increasingly networked society.</p>

<p>I am also very lucky to serve with Lauren-Glenn on the editorial board of the <a href="http://communitymediareview.org/">Community Media Review</a>.</p>

<p>The video itself is approximately 1 hour, 24 minutes long and worth every second, but I included my notes from the session below.</p>

<blockquote>
  <p>Community building talent is the single most important resource in the modern world.</p>
</blockquote>

<p>Peter Drucker</p>

<h3 id="how-to-engage-and-mobilize-members">How to engage and mobilize members</h3>

<p>A Communications framework for thinking about how organizational objectives are met through interaction. The correlating Development framework is in parenthesis.</p>

<ol>
  <li><strong>Welcome</strong> (Prospect)</li>
  <li><strong>Educate</strong> (Cultivation)</li>
  <li><strong>Ask</strong> (Involvement)</li>
  <li><strong>Thank</strong> (Stewardship)</li>
</ol>

<h3 id="the-seven-steps">The Seven Steps</h3>

<ol>
  <li><strong>Assessment</strong>: Defining your goal (What behavior are you trying to change in undertaking a communications strategy?), audience (an explicit, targeted “who” and their values), evaluating your infrastructure (orthodoxies, structure, time, leadership)</li>
  <li><strong>Awareness</strong>: Start by searching <a href="http://nten.org">NTEN</a>, <a href="http://techsoup.org">TechSoup</a>, <a href="http://www.idealware.org/">Idealware</a>, etc. (Link Research)</li>
  <li><strong>Training</strong>: A discipline of doing things. How are stories told, infrastructure built and actions communicated to regular people?</li>
  <li><strong>Content Production</strong>: “The currency of the new world”</li>
  <li><strong>Technical Support</strong>: An example: how to know when to build and when to buy</li>
  <li><strong>Partnerships</strong>: Who is going to stand up for you?</li>
  <li><strong>Planning</strong>: What are the components that revolve around your goal?</li>
</ol>

<h3 id="other-links">Other Links</h3>

<ul>
  <li><a href="https://secure.spinproject.org/modinput4.php?modin=56">Strategic Communications Plan Generator</a> from The SPIN Project</li>
  <li><a href="http://www.npowerseattle.org/education/resources/communications.htm">Tech Savvy Communications Toolkit</a> from NPower Seattle</li>
  <li>Storytelling: <a href="http://www.agoodmanonline.com/">Andy Goodman</a>, <a href="http://sethgodin.typepad.com/">Seth Godin</a>, <a href="http://www.gilbert.org/">The Gilbert Center</a></li>
</ul>

<p><em>I shot this video with a <a href="http://www.amazon.com/Casio-Exilim-EX-S600-Digital-Optical/dp/B000E158D4">Casio EX-S600</a>, which shoots full-frame (640 x 480) MPEG-4 video. With a two gigabyte SD Card it can shoot approximately an hour and a half of video at medium quality before its battery dies. The Casio’s AVI wrapper is incompatible with iMovie (or any Quicktime decoder), so I first used <a href="http://www.techspansion.com/visualhub/">VisualHub</a> to repackage the video as an MP4 before importing into iMovie to add titles. I exported from iMovie as DV and then converted that with VisualHub into MPEG-4. Compressed and at quarter-frame (320 x 240) the entire video was 105 MB. This time I uploaded to Google Video since <a href="http://blip.tv">Blip.tv</a> stalled out.</em></p>

  </div>
</article>


    <hr>
  
    

<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">
      <a class="post-link" href="/2007/04/MeetAmeriCorps-still-a-success.html">MeetAmeriCorps still a success</a>
    </h1>
    <p class="post-meta text-muted">
      <time datetime="2007-04-02T00:00:00+00:00" itemprop="datePublished">April 2, 2007</time>
      
      


  

  

  • Tagged <a href="/tags/#AmeriCorps">AmeriCorps</a>, <a href="/tags/#meetamericorps">meetamericorps</a>, <a href="/tags/#nptech">nptech</a>, <a href="/tags/#social_networking">social networking</a>, and <a href="/tags/#webdesign">webdesign</a>


    </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p><a href="http://www.flickr.com/photos/bensheldon/444085635/" title="Photo Sharing"> <img src="http://farm1.static.flickr.com/235/444085635_15a71d43c8.jpg" alt="The Faces of MeetAmeriCorps.com" /> </a></p>

<p>I just got back from some extended travel in California where I met with some fellow AmeriCorps*VISTAs and, among other things, discussed how we could get our <a href="http://meetamericorps.com">AmeriCorps social networking website</a> growing even faster. Right now the site has over 300 registered users, which is pretty good for a six month old baby.</p>

<p>Most importantly, we’re working on stepping up our outreach. Unlike what some of the hype may tell you, social networking website don’t build themselves. If you build it, they <em>won’t</em> come, at least not if you don’t tell anyone about.</p>

<p><strong>Outreach is key</strong>, and unfortunately it usually means a change of strategy. We’re building our networks online because it’s cheap real estate, but on the internet you can’t shout very far and most people are deaf. If you’re trying to get in front of someone’s face (or next to their ear), putting something on the internet is probably the worst way to go about it.</p>

<p><strong>Physical objects are best</strong>, so I’m in the process of designing a postcard to mail out to AmeriCorps host organizations.</p>

<p>Also, because MeetAmeriCorps.com already has so many <a href="http://meetamericorps.com/map">members across the country</a>, we can have them lend a hand too in outreach activities. That’s always a benefit of working with AmeriCorps: we love to help.</p>


  </div>
</article>


    
  

  <hr>

<nav aria-label="Page navigation">
  <ul class="pagination justify-content-center">
    
      <li class="page-item"><a href="/page/53/" class="page-link"><span aria-hidden="true">&larr; </span>Newer</a></li>
    

    <li class="page-item"><span class="page-link active">Page 54 of 64</span></li>

    
      <li class="page-item"><a href="/page/55/" class="page-link">Older<span aria-hidden="true"> &rarr;</span></a></li>
    
  </ul>
</nav>

</div>

    </div>

    <footer class="site-footer">

</footer>


  </body>

</html>
